#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Telegram –ë–æ—Ç –¥–ª—è –ë–µ–≥–æ–≤–æ–≥–æ –°–æ–æ–±—â–µ—Å—Ç–≤–∞
–§—É–Ω–∫—Ü–∏–∏: –£—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –ü–æ–≥–æ–¥–∞, –¢–µ–º—ã –¥–Ω—è, –ê–Ω–æ–Ω–∏–º–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞, –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞, –†–µ–π—Ç–∏–Ω–≥, –£—Ä–æ–≤–Ω–∏
"""

import os
import asyncio
import logging
import threading
import time
import random
import httpx
import signal
import sys
from datetime import datetime, timedelta
from telegram import Update
from telegram.ext import (
    ApplicationBuilder,
    CommandHandler,
    MessageHandler,
    ContextTypes,
    CallbackQueryHandler,
    filters,
)
import pytz
from flask import Flask

# ============== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==============
BOT_TOKEN = os.environ.get("TELEGRAM_BOT_TOKEN")
if not BOT_TOKEN:
    raise ValueError("–¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω!")

RENDER_URL = os.environ.get("RENDER_URL", "")

CHAT_ID = os.environ.get("CHAT_ID")
if not CHAT_ID:
    raise ValueError("CHAT_ID –Ω–µ –Ω–∞–π–¥–µ–Ω!")

try:
    CHAT_ID = int(CHAT_ID)
except ValueError:
    raise ValueError("CHAT_ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º!")

MOSCOW_TZ = pytz.timezone("Europe/Moscow")

logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    level=logging.INFO,
)
logger = logging.getLogger(__name__)

# ============== FLASK ==============
app = Flask(__name__)


@app.route("/")
def home():
    return "Bot is running!"


@app.route("/health")
def health():
    return "OK"


def run_flask():
    app.run(host="0.0.0.0", port=10000)


# ============== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==============
application = None
morning_message_id = None
morning_scheduled_date = ""
bot_running = True
motivation_sent_times = []

# ============== –ù–û–ß–ù–û–ô –†–ï–ñ–ò–ú ==============
night_messages_count = 0
night_warning_sent = False

# ============== –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–ï –í–û–ó–í–†–ê–©–ï–ù–¶–ï–í ==============
# {user_id: last_active_date}
user_last_active = {}

# ============== –°–¢–ê–¢–ò–°–¢–ò–ö–ê –î–õ–Ø –ï–ñ–ï–î–ù–ï–í–ù–û–ô –°–í–û–î–ö–ò ==============
daily_stats = {
    "date": "",
    "total_messages": 0,
    "user_messages": {},  # {user_id: {"name": str, "count": int}}
    "photos": [],  # [{"file_id": str, "user_id": int, "likes": int, "message_id": int}]
}
daily_summary_sent = False

# ============== –†–ï–ô–¢–ò–ù–ì –£–ß–ê–°–¢–ù–ò–ö–û–í ==============
# {user_id: {"name": str, "messages": int, "photos": int, "likes": int, "replies": int}}
user_rating_stats = {}

# {user_id: "–ù–æ–≤–∏—á–æ–∫"} - —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_current_level = {}

# ============== –ó–ê–©–ò–¢–ê –û–¢ –ù–ê–ö–†–£–¢–û–ö ==============
# –ú–∞–∫—Å–∏–º—É–º –±–∞–ª–ª–æ–≤ –≤ —á–∞—Å
MAX_POINTS_PER_HOUR = 20
# –ú–∞–∫—Å–∏–º—É–º —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤
MAX_MESSAGES_PER_MINUTE = 5
# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –±–∞–ª–ª–∞
MIN_MESSAGE_LENGTH = 5
# {user_id: [–≤—Ä–µ–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π]}
user_message_times = {}

# ============== –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–´ –†–ï–ô–¢–ò–ù–ì–ê ==============
POINTS_PER_MESSAGES = 300  # –ó–∞ —Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–∞—ë—Ç—Å—è 1 –±–∞–ª–ª
POINTS_PER_PHOTOS = 10    # –ó–∞ —Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ –¥–∞—ë—Ç—Å—è 1 –±–∞–ª–ª
POINTS_PER_LIKES = 50     # –ó–∞ —Å–∫–æ–ª—å–∫–æ –ª–∞–π–∫–æ–≤ –¥–∞—ë—Ç—Å—è 1 –±–∞–ª–ª
POINTS_PER_REPLY = 1      # –ó–∞ –∫–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ —Ç–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ

# ============== –£–†–û–í–ù–ò –£–ß–ê–°–¢–ù–ò–ö–û–í ==============
USER_LEVELS = {
    "–ù–æ–≤–∏—á–æ–∫": 0,         # 0+ –æ—á–∫–æ–≤
    "–ê–∫—Ç–∏–≤–Ω—ã–π": 10,       # 10+ –æ—á–∫–æ–≤
    "–õ–∏–¥–µ—Ä": 50,          # 50+ –æ—á–∫–æ–≤
    "–õ–µ–≥–µ–Ω–¥–∞ —á–∞—Ç–∞": 100,   # 100+ –æ—á–∫–æ–≤
}

LEVEL_EMOJIS = {
    "–ù–æ–≤–∏—á–æ–∫": "üå±",
    "–ê–∫—Ç–∏–≤–Ω—ã–π": "‚≠ê",
    "–õ–∏–¥–µ—Ä": "üëë",
    "–õ–µ–≥–µ–Ω–¥–∞ —á–∞—Ç–∞": "üèÜ",
}

# ============== –£–ß–Å–¢ –ù–ï–î–ï–õ–¨ ==============
current_week = 0

# ============== –î–ê–ù–ù–´–ï ==============
DAY_THEMES = {
    "Monday": "üéµ –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ ‚Äî –¥–µ–Ω—å –º—É–∑—ã–∫–∏! –ö–∞–∫–∞—è –ø–µ—Å–Ω—è –∑–∞–≤–æ–¥–∏—Ç —Ç–µ–±—è –Ω–∞ –ø—Ä–æ–±–µ–∂–∫—É?",
    "Tuesday": "üêï –í—Ç–æ—Ä–Ω–∏–∫ ‚Äî –¥–µ–Ω—å –ø–∏—Ç–æ–º—Ü–µ–≤! –ü–æ–∫–∞–∂–∏ —Å–≤–æ–µ–≥–æ —á–µ—Ç–≤–µ—Ä–æ–Ω–æ–≥–æ–≥–æ –Ω–∞–ø–∞—Ä–Ω–∏–∫–∞!",
    "Wednesday": "üíù –°—Ä–µ–¥–∞ ‚Äî –¥–µ–Ω—å –¥–æ–±—Ä—ã—Ö –¥–µ–ª! –ü–æ–¥–µ–ª–∏—Å—å, –∫–æ–º—É —Ç—ã —Å–µ–≥–æ–¥–Ω—è –ø–æ–º–æ–≥!",
    "Thursday": "üçï –ß–µ—Ç–≤–µ—Ä–≥ ‚Äî –¥–µ–Ω—å –µ–¥—ã! –ß—Ç–æ —Ç—ã –µ—à—å –ø–µ—Ä–µ–¥ –∏ –ø–æ—Å–ª–µ –ø—Ä–æ–±–µ–∂–∫–∏?",
    "Friday": "üì∏ –ü—è—Ç–Ω–∏—Ü–∞ ‚Äî –¥–µ–Ω—å —Å–µ–ª—Ñ–∏! –ü–æ–∫–∞–∂–∏ —Å–≤–æ—ë –ª–∏—Ü–æ –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏!",
    "Saturday": "üò© –°—É–±–±–æ—Ç–∞ ‚Äî –¥–µ–Ω—å –Ω—ã—Ç—å—è! –†–∞—Å—Å–∫–∞–∂–∏, —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è –±—ã–ª–æ —Ç—è–∂–µ–ª–æ!",
    "Sunday": "üì∑ –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ ‚Äî –¥–µ–Ω—å –Ω—é–¥—Å–æ–≤! –ü–æ–∫–∞–∂–∏ –∫—Ä–∞—Å–∏–≤—ã–µ –≤–∏–¥—ã —Å –ø—Ä–æ–±–µ–∂–∫–∏!",
}

WELCOME_MESSAGES = [
    "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à –±–µ–≥–æ–≤–æ–π –º—É—Ä–∞–≤–µ–π–Ω–∏–∫! –¢—ã —É–∂–µ –≤—ã–±—Ä–∞–ª —Å–≤–æ—é –¥–∏—Å—Ç–∞–Ω—Ü–∏—é: 5 –∫–º –¥–ª—è —Ä–∞–∑–º–∏–Ω–∫–∏, –ø–æ–ª—É–º–∞—Ä–∞—Ñ–æ–Ω –¥–ª—è –¥—É—à–∏ –∏–ª–∏ —Å—Ä–∞–∑—É —É–ª—å—Ç—Ä–∞–º–∞—Ä–∞—Ñ–æ–Ω ‚Äî —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–∞ —á—Ç–æ —Å–ø–æ—Å–æ–±–µ–Ω? –†–∞—Å—Å–∫–∞–∂–∏, –∫–∞–∫–æ–π —É —Ç–µ–±—è —É—Ä–æ–≤–µ–Ω—å: ¬´–µ—â—ë –¥—ã—à—É¬ª, ¬´—É–∂–µ –ø–æ—Ç–µ—é¬ª –∏–ª–∏ ¬´—è ‚Äî –º–∞—à–∏–Ω–∞¬ª?",
    "–ü—Ä–∏–≤–µ—Ç, –Ω–æ–≤–∏—á–æ–∫! –í –Ω–∞—à–µ–º —á–∞—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ—Å—Ç—ã–µ: –µ—Å–ª–∏ –Ω–µ –º–æ–∂–µ—à—å –±–µ–∂–∞—Ç—å ‚Äî –∏–¥–∏, –µ—Å–ª–∏ –Ω–µ –º–æ–∂–µ—à—å –∏–¥—Ç–∏ ‚Äî –ø–æ–ª–∑–∏, –Ω–æ –≥–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–µ —Å–¥–∞–≤–∞–π—Å—è! –¢–∞–∫ —Ç—ã –∫—Ç–æ: –Ω–∞—á–∏–Ω–∞—é—â–∏–π —Å—Ç–∞–π–µ—Ä, –æ–ø—ã—Ç–Ω—ã–π –º–∞—Ä–∞—Ñ–æ–Ω–µ—Ü –∏–ª–∏ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π —Ä–µ–∫–æ—Ä–¥—Å–º–µ–Ω –≤ –æ–∂–∏–¥–∞–Ω–∏–∏?",
    "–û–≥–æ, –Ω–æ–≤—ã–π –±–µ–≥—É–Ω –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–µ! –°—Ä–æ—á–Ω–æ –∑–∞–ø–æ–ª–Ω–∏ –∞–Ω–∫–µ—Ç—É: –∏–º—è, –ª—é–±–∏–º—ã–π –º–∞—Ä—à—Ä—É—Ç –∏ —Ü–µ–ª—å –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–π –∑–∞–±–µ–≥ (–æ—Ç ¬´–ø—Ä–æ—Å—Ç–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å¬ª –¥–æ ¬´–ø–æ—Ä–≤–∞—Ç—å –≤—Å–µ—Ö –Ω–∞ —Ñ–∏–Ω–∏—à–µ¬ª). –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–º–∞–Ω–¥—É!",
    "–ü—Ä–∏–≤–µ—Ç! –¢—ã –ø–æ–ø–∞–ª –≤ –º–µ—Å—Ç–æ, –≥–¥–µ –∫–∏–ª–æ–º–µ—Ç—Ä—ã —Å—á–∏—Ç–∞—é—Ç –Ω–µ –ø–æ GPS, –∞ –ø–æ —É–ª—ã–±–∫–∞–º. –¢–∞–∫ —á—Ç–æ —Ç—ã: —Ç–æ—Ç, –∫—Ç–æ —Ç–æ–ª—å–∫–æ —É—á–∏—Ç—Å—è –∑–∞–≤—è–∑—ã–≤–∞—Ç—å –∫—Ä–æ—Å—Å–æ–≤–∫–∏, —É–∂–µ –±–µ–≥–∞–µ—Ç –ø–æ —É—Ç—Ä–∞–º –∏–ª–∏ –≥–æ—Ç–æ–≤ –ø—Ä–æ–±–µ–∂–∞—Ç—å –º–∞—Ä–∞—Ñ–æ–Ω –≤ –ø–∏–∂–∞–º–µ?",
    "–í–Ω–∏–º–∞–Ω–∏–µ! –í —á–∞—Ç–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω —Å–≤–µ–∂–∏–π –±–µ–≥–æ–≤–æ–π —Ä–µ—Å—É—Ä—Å! –û–±—ä–µ–∫—Ç, –Ω–∞–∑–æ–≤–∏—Ç–µ –≤–∞—à —Å—Ç–∞—Ç—É—Å: ¬´–µ—â—ë –Ω–µ –ø—Ä–æ–±–µ–∂–∞–ª –ø–µ—Ä–≤—ã–π –∫–º¬ª, ¬´—É–∂–µ –≤—Ç—è–Ω—É–ª—Å—è¬ª –∏–ª–∏ ¬´—è —Ç—É—Ç –≥–ª–∞–≤–Ω—ã–π –ø–µ–π—Å–º–µ–π–∫–µ—Ä¬ª?",
    "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–µ–≥–æ–≤—É—é —Å–µ–º—å—é! –£ –Ω–∞—Å —Ç—É—Ç —Ç—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: –Ω–æ–≤–∏—á–∫–∏ (–∫–æ—Ç–æ—Ä—ã–µ –±–æ—è—Ç—Å—è —Å–ª–æ–≤–∞ ¬´–º–∞—Ä–∞—Ñ–æ–Ω¬ª), –ª—é–±–∏—Ç–µ–ª–∏ (–∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∑–Ω–∞—é—Ç, —á—Ç–æ —Ç–∞–∫–æ–µ –∫—Ä–µ–ø–∞—Ç—É—Ä–∞) –∏ –ª–µ–≥–µ–Ω–¥—ã (–∫–æ—Ç–æ—Ä—ã–µ –±–µ–≥–∞—é—Ç –¥–∞–∂–µ –≤–æ —Å–Ω–µ). –ö –∫–∞–∫–æ–π –æ—Ç–Ω–æ—Å–∏—à—å—Å—è —Ç—ã?",
    "–≠–π, –Ω–æ–≤–µ–Ω—å–∫–∏–π! –ü—Ä–∏–∑–Ω–∞–≤–∞–π—Å—è: —Ç—ã —Ç—É—Ç —á—Ç–æ–±—ã —Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∫–æ—Ä–¥—ã, –∏—Å–∫–∞—Ç—å –º–æ—Ç–∏–≤–∞—Ü–∏—é –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–±–æ–ª—Ç–∞—Ç—å –æ –∫—Ä–æ—Å—Å–æ–≤–∫–∞—Ö? –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ ‚Äî –±–µ–≥–∏ –∫ –Ω–∞–º, —É –Ω–∞—Å –≤–µ—Å–µ–ª–æ!",
    "–ü—Ä–∏–≤–µ—Ç-–ø—Ä–∏–≤–µ—Ç! –¢—ã —Å–µ–π—á–∞—Å –Ω–∞ —ç—Ç–∞–ø–µ: ¬´–∫—Ç–æ –≤—Å–µ —ç—Ç–∏ –±–µ–≥—É–Ω—ã?¬ª, ¬´–æ, —Ç—É—Ç –∫–ª–∞—Å—Å–Ω—ã–µ —Ä–µ–±—è—Ç–∞¬ª –∏–ª–∏ ¬´—è –∑–Ω–∞—é –≤—Å–µ —Ç—Ä–∞—Å—Å—ã, –Ω–æ –Ω–∏–∫–æ–º—É –Ω–µ —Å–∫–∞–∂—É¬ª? –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à –∑–∞–±–µ–≥!",
    "–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫? –û—Ç–ª–∏—á–Ω–æ! –£ –Ω–∞—Å –µ—Å—Ç—å —Ç—Ä–∏ —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: –ª—ë–≥–∫–∏–π (–ø—Ä–æ—Å—Ç–æ –≤—ã–π—Ç–∏ –Ω–∞ –ø—Ä–æ–±–µ–∂–∫—É), —Å—Ä–µ–¥–Ω–∏–π (–Ω–µ —Å–æ–π—Ç–∏ —Å –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏) –∏ —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π (—É–ª—ã–±–∞—Ç—å—Å—è –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö). –ö–∞–∫–æ–π –≤—ã–±–∏—Ä–∞–µ—à—å?",
    "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç, –≥–¥–µ –∫–∏–ª–æ–º–µ—Ç—Ä—ã ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ü–∏—Ñ—Ä—ã, –∞ –∏—Å—Ç–æ—Ä–∏–∏! –¢—ã –∫—Ç–æ: —Ç–æ—Ç, –∫—Ç–æ —Ç–æ–ª—å–∫–æ –º–µ—á—Ç–∞–µ—Ç –æ –ø–µ—Ä–≤–æ–º –∑–∞–±–µ–≥–µ, —É–∂–µ —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ–¥–∞–ª–∏ –∏–ª–∏ –≥–æ—Ç–æ–≤ –ø—Ä–æ–±–µ–∂–∞—Ç—å 42 –∫–º —Ä–∞–¥–∏ —à—É—Ç–∫–∏?",
]

MOTIVATION_QUOTES = [
    "üèÉ –°–µ–≥–æ–¥–Ω—è –æ—Ç–ª–∏—á–Ω—ã–π –¥–µ–Ω—å, —á—Ç–æ–±—ã —Å—Ç–∞—Ç—å –ª—É—á—à–µ!",
    "üí™ –ö–∞–∂–¥—ã–π –∫–º ‚Äî —ç—Ç–æ –ø–æ–±–µ–¥–∞ –Ω–∞–¥ —Å–æ–±–æ–π!",
    "üöÄ –ù–µ –∂–¥–∏ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞. –°–æ–∑–¥–∞–π –µ–≥–æ —Å–≤–æ–∏–º –±–µ–≥–æ–º!",
    "üî• –¢–≤–æ–π –¥–∏–≤–∞–Ω —Å–∫—É—á–∞–µ—Ç, –∞ –±–µ–≥ –∂–¥—ë—Ç —Ç–µ–±—è!",
    "‚≠ê –°–µ–≥–æ–¥–Ω—è —Ç—ã –±–µ–∂–∏—à—å –∑–∞–≤—Ç—Ä–∞—à–Ω—é—é –≤–µ—Ä—Å–∏—é —Å–µ–±—è!",
    "üí® –ë–æ–ª—å—à–µ –±–µ–≥–∞ ‚Äî –º–µ–Ω—å—à–µ —Å—Ç—Ä–µ—Å—Å–∞!",
    "üéØ –ü—Ä–æ–±–µ–∂–∫–∞ —Å–µ–≥–æ–¥–Ω—è = —É–ª—ã–±–∫–∞ –∑–∞–≤—Ç—Ä–∞!",
    "üèÖ –ì–ª–∞–≤–Ω—ã–π –∑–∞–±–µ–≥ ‚Äî —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –Ω–∞—á–∞–ª!",
    "üåü –õ—É—á—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –±–µ–≥–∞ ‚Äî —Å–µ–π—á–∞—Å!",
    "üí• –¢—ã —Å–∏–ª—å–Ω–µ–µ, —á–µ–º –¥—É–º–∞–µ—à—å!",
    "‚ö° –ö–∞–∂–¥—ã–π —à–∞–≥ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç —Ç–µ–±—è –∫ —Ü–µ–ª–∏!",
    "üåà –ü–æ—Å–ª–µ –ø—Ä–æ–±–µ–∂–∫–∏ –º–∏—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —è—Ä—á–µ!",
    "üî• –î–∏–≤–∞–Ω ‚Äî —ç—Ç–æ –Ω–µ —Ç–≤–æ–π –¥–æ–º. –î–æ—Ä–æ–≥–∞ ‚Äî —Ç–≤–æ–π –¥—Ä—É–≥!",
    "üí™ –í—á–µ—Ä–∞ —Ç—ã –Ω–µ —Å–º–æ–≥. –°–µ–≥–æ–¥–Ω—è —Ç—ã –±–µ–∂–∏—à—å!",
    "‚≠ê –ë–µ–≥ ‚Äî —ç—Ç–æ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –Ω—É–∂–Ω–æ –ø–æ–∫—É–ø–∞—Ç—å!",
    "üéì –ë–µ–≥ —É—á–∏—Ç –Ω–∞—Å, —á—Ç–æ —Ñ–∏–Ω–∏—à –≤—Å–µ–≥–¥–∞ –±–ª–∏–∂–µ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è!",
    "üèÜ –°–µ–≥–æ–¥–Ω—è—à–Ω—è—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ‚Äî —ç—Ç–æ –∑–∞–≤—Ç—Ä–∞—à–Ω—è—è –ø–æ–±–µ–¥–∞!",
    "üåÖ –£—Ç—Ä–µ–Ω–Ω—è—è –ø—Ä–æ–±–µ–∂–∫–∞ –¥–∞—ë—Ç —Å–∏–ª –Ω–∞ –≤–µ—Å—å –¥–µ–Ω—å!",
    "üíÜ –ë–µ–≥ ‚Äî –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –≥–æ–ª–æ–≤—É!",
    "üîÑ –ö–∞–∂–¥—ã–π –∫—Ä—É–≥ ‚Äî —ç—Ç–æ —à–∞–Ω—Å —Å—Ç–∞—Ç—å –ª—É—á—à–µ!",
    "ü§ù –ë–µ–≥ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å–∏–ª—å–Ω—ã—Ö –¥—É—Ö–æ–º!",
    "üé™ –ñ–∏–∑–Ω—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∞, —á—Ç–æ–±—ã –Ω–µ –±–µ–≥–∞—Ç—å!",
    "üßò‚Äç‚ôÄÔ∏è –ë–µ–≥ ‚Äî —ç—Ç–æ –º–µ–¥–∏—Ç–∞—Ü–∏—è –≤ –¥–≤–∏–∂–µ–Ω–∏–∏!",
    "üöÄ –û—Å—Ç–∞–Ω–æ–≤–∏—Å—å ‚Äî –∏ –ø–æ—Ç–µ—Ä—è–µ—à—å —Ç–µ–º–ø!",
    "üí´ –ë–µ–≥–∏ —Ç–∞–∫, –±—É–¥—Ç–æ –Ω–∏–∫—Ç–æ –Ω–µ —Å–º–æ—Ç—Ä–∏—Ç!",
    "üèÉ‚Äç‚ôÇÔ∏è –ù–µ –±–µ–≥–∞–π –æ—Ç –ø—Ä–æ–±–ª–µ–º ‚Äî –±–µ–≥–∏ –∫ —Ü–µ–ª—è–º!",
    "‚≠ê –ö–∞–∂–¥—ã–π —Å–ø–æ—Ä—Ç—Å–º–µ–Ω –±—ã–ª –Ω–æ–≤–∏—á–∫–æ–º. –ù–∞—á–Ω–∏ —Å–µ–≥–æ–¥–Ω—è!",
    "üî• –°–ª–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 5 –∫–º. –î–∞–ª—å—à–µ ‚Äî –ª–µ–≥—á–µ!",
    "üí™ –¢–≤–æ–∏ –Ω–æ–≥–∏ —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è –ø–æ–ª—ë—Ç–∞!",
    "üåü –ë–µ–≥ ‚Äî —ç—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞. –≠—Ç–æ —Å–≤–æ–±–æ–¥–∞!",
    "üéØ –ü–æ—Å—Ç–∞–≤—å —Ü–µ–ª—å ‚Äî –∏ –±–µ–≥–∏ –∫ –Ω–µ–π!",
    "üí• –ë–æ–ª—å—à–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥–µ—Ç ¬´—Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ¬ª –∏–ª–∏ ¬´—Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ¬ª!",
    "üèÉ‚Äç‚ôÄÔ∏è –ù–∞—á–Ω–∏ –±–µ–∂–∞—Ç—å ‚Äî –∏ —É–≤–∏–¥–∏—à—å, –∫–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—Å—è –∂–∏–∑–Ω—å!",
    "‚≠ê –î–∏–≤–∞–Ω –Ω–µ –¥–∞—Å—Ç —Ç–µ–±–µ –º–µ–¥–∞–ª—å. –ê –±–µ–≥ ‚Äî –¥–∞—Å—Ç!",
    "üî• –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä!",
    "üí™ –í–µ—Ä—å –≤ —Å–µ–±—è ‚Äî –∏ –±–µ–≥–∏!",
    "üåü –¢—ã –º–æ–∂–µ—à—å –±–æ–ª—å—à–µ, —á–µ–º –¥—É–º–∞–µ—à—å!",
]

# ============== –°–ú–ï–®–ù–´–ï –†–£–ì–ê–¢–ï–õ–¨–°–¢–í–ê ==============
FUNNY_INSULTS = [
    "–¢—ã –∫–∞–∫ –±—Ä–æ–∫–∫–æ–ª–∏ ‚Äî –Ω–∏–∫—Ç–æ –Ω–µ –∑–Ω–∞–µ—Ç, –∑–∞—á–µ–º —Ç—ã –Ω—É–∂–µ–Ω, –∏ –≤—Å–µ –¥–µ–ª–∞—é—Ç –≤–∏–¥, —á—Ç–æ —Ç–µ–±—è –Ω–µ—Ç.",
    "–ï—Å–ª–∏ –±—ã —Ç—É–ø–æ—Å—Ç—å –±—ã–ª–∞ –æ–ª–∏–º–ø–∏–π—Å–∫–∏–º –≤–∏–¥–æ–º —Å–ø–æ—Ä—Ç–∞, —Ç—ã –±—ã —É–∂–µ –≤—ã–∏–≥—Ä–∞–ª –∑–æ–ª–æ—Ç–æ, —Å–µ—Ä–µ–±—Ä–æ –∏ –±—Ä–æ–Ω–∑—É –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.",
    "–¢—ã –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —á–µ–ª–æ–≤–µ–∫, —É –∫–æ—Ç–æ—Ä–æ–≥–æ Wi-Fi —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º —Ç–≤–æ–∏ –º–æ–∑–≥–∏.",
    "–¢–≤–æ—è –ª–æ–≥–∏–∫–∞ –∫–∞–∫ wi-fi –≤ –º–µ—Ç—Ä–æ ‚Äî –µ—Å—Ç—å, –Ω–æ —Ç–æ–ª–∫—É –Ω–æ–ª—å.",
    "–¢—ã –¥—É–º–∞–µ—à—å, —á—Ç–æ —Ç–≤–æ—ë –º–Ω–µ–Ω–∏–µ –≤–∞–∂–Ω–æ? –≠—Ç–æ –º–∏–ª–æ. –ü—Ä–∞–≤–¥–∞, –º–∏–ª–æ.",
    "–Ø –±—ã –Ω–∞–∑–≤–∞–ª —Ç–µ–±—è –∏–¥–∏–æ—Ç–æ–º, –Ω–æ —Ç–æ–≥–¥–∞ –±—ã —è —Å–æ–≤—Ä–∞–ª, –∞ —è —Å–µ–±–µ —Ç–∞–∫–æ–≥–æ –Ω–µ –ø–æ–∑–≤–æ–ª—è—é.",
    "–¢—ã –∫–∞–∫ –π–æ–≥—É—Ä—Ç —Å –∏—Å—Ç—ë–∫—à–∏–º —Å—Ä–æ–∫–æ–º ‚Äî –ª–µ–∂–∞–ª-–ª–µ–∂–∞–ª, –∞ –ø–æ—Ç–æ–º –≤—ã–±—Ä–æ—Å–∏–ª–∏.",
    "–ï—Å–ª–∏ –±—ã –Ω–µ—É–¥–∞—á–∏ –±—ã–ª–∏ –∫–æ–Ω–∫—É—Ä—Å–æ–º –∫—Ä–∞—Å–æ—Ç—ã, —Ç—ã –±—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –±–∞–ª–∞.",
    "–¢–≤–æ—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∂–∏–∑–Ω–∏: ¬´–ê–≤–æ—Å—å –ø—Ä–æ–Ω–µ—Å—ë—Ç¬ª. –ò –≤–µ–¥—å –Ω–µ –ø—Ä–æ–Ω–µ—Å–ª–æ.",
    "–¢—ã –∫–∞–∫ –±—É–º–µ—Ä–∞–Ω–≥ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—à—å—Å—è, –Ω–æ –Ω–∏–∫—Ç–æ —ç—Ç–æ–≥–æ –Ω–µ —Ö–æ—á–µ—Ç.",
    "–î—É–º–∞–µ—à—å, —Ç—ã –≤–∞–∂–µ–Ω? –°–≤–µ—á–∫–∞ –≤ —Ç–æ—Ä—Ç–µ —Ç–æ–∂–µ –¥—É–º–∞–µ—Ç, —á—Ç–æ –æ–Ω–∞ –≥–ª–∞–≤–Ω–∞—è, –ø–æ–∫–∞ –µ—ë –Ω–µ –∑–∞–¥—É–ª–∏.",
    "–¢—ã –∫–∞–∫ –ø–∞–∑–ª ‚Äî 1000 –¥–µ—Ç–∞–ª–µ–π, –Ω–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è.",
    "–¢–≤–æ—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ–±–µ –≤–æ—Å—Ö–∏—â–∞–µ—Ç. –ò –ø—É–≥–∞–µ—Ç. –í –æ—Å–Ω–æ–≤–Ω–æ–º –ø—É–≥–∞–µ—Ç.",
    "–ï—Å–ª–∏ –±—ã –≥–ª—É–ø–æ—Å—Ç—å –±—ã–ª–∞ –±–æ–ª—å—é, —Ç—ã –±—ã –æ—Ä–∞–ª –Ω–∞ –≤–µ—Å—å –º–∏—Ä.",
    "–¢—ã –∫–∞–∫ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä ‚Äî –ø–æ–∫–∞ –∑–∞—Ä—è–∂–∞–µ—à—å, —É–∂–µ —Ä–∞–∑—Ä—è–¥–∏–ª—Å—è.",
    "–¢–≤–æ—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤—Å—ë –ø–æ—Ä—Ç–∏—Ç—å –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π –Ω–∞–≥—Ä–∞–¥—ã.",
    "–¢—ã –∫–∞–∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç ‚Äî —Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç–æ –Ω–µ—Ç, –∞ —Ç–æ–ª–∫—É –æ—Ç —Ç–µ–±—è –∫–∞–∫ –æ—Ç —Å–æ–ª—ë–Ω–æ–≥–æ –æ–≥—É—Ä—Ü–∞ –≤ —à–æ–∫–æ–ª–∞–¥–µ.",
    "–ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —Ç—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å —Ä–æ—Ç, —è –ø–æ–Ω–∏–º–∞—é, –ø–æ—á–µ–º—É –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ª—é–¥–∏ –≤—ã–±–∏—Ä–∞—é—Ç –º–æ–ª—á–∞–Ω–∏–µ.",
    "–¢—ã –∫–∞–∫ –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –≤—Å–µ —Ç–µ–±—è —Ç–µ—Ä–ø—è—Ç, –Ω–æ –Ω–∏–∫—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç —Å —Ç–æ–±–æ–π –æ–±—â–∞—Ç—å—Å—è.",
    "–¢–≤–æ—è –ª–æ–≥–∏–∫–∞ —Å–ª–æ–º–∞–Ω–∞ —Å–∏–ª—å–Ω–µ–µ, —á–µ–º —ç–∫—Ä–∞–Ω —É –±–∞–±—É—à–∫–∏–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.",
    "–¢—ã –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π —É–º—É–¥—Ä—è–µ—Ç—Å—è —É–ø–∞—Å—Ç—å –Ω–∞ —Ä–æ–≤–Ω–æ–º –º–µ—Å—Ç–µ, –Ω–æ –≤ –ª—É–∂—É –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç.",
    "–ï—Å–ª–∏ –±—ã —Ç–≤–æ—è –≥–ª—É–ø–æ—Å—Ç—å –±—ã–ª–∞ —ç–Ω–µ—Ä–≥–∏–µ–π, –º—ã –±—ã –∑–∞–±—ã–ª–∏ –ø—Ä–æ –Ω–µ—Ñ—Ç—å –∏ –≥–∞–∑.",
    "–¢—ã –∫–∞–∫ —á–∞–π–Ω—ã–π –ø–∞–∫–µ—Ç–∏–∫ ‚Äî —Å–Ω–∞—á–∞–ª–∞ –≤ –≥–æ—Ä—è—á—É—é –≤–æ–¥—É, –∞ –ø–æ—Ç–æ–º –≤—ã–±—Ä–æ—Å–∏–ª–∏.",
    "–¢–≤–æ–∏ —Ä–µ—à–µ–Ω–∏—è —Ö—É–∂–µ, —á–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã –≤ –≥–æ—Ä–∞—Ö ‚Äî –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ –∏ –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ.",
    "–¢—ã –∫–∞–∫ –ª–∏–º–æ–Ω ‚Äî –∫–∏—Å–ª—ã–π, –º–æ—Ä—â–∏–Ω–∏—Å—Ç—ã–π –∏ –æ—Ç —Ç–µ–±—è –≤—Å–µ –º–æ—Ä—â–∞—Ç—Å—è.",
    "–ï—Å–ª–∏ –±—ã –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å –±—ã–ª–∞ –º—É–∑—ã–∫–∞–ª—å–Ω—ã–º –∂–∞–Ω—Ä–æ–º, —Ç—ã –±—ã –Ω–µ –ø–æ–ø–∞–ª –≤ –ø–ª–µ–π–ª–∏—Å—Ç.",
    "–¢—ã –∫–∞–∫ –±–∞—Ç–∞—Ä–µ–π–∫–∞ ‚Äî —Å–µ–ª –≤ —Å–∞–º—ã–π –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π –º–æ–º–µ–Ω—Ç.",
    "–¢–≤–æ—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤—Å—ë —É—Å–ª–æ–∂–Ω—è—Ç—å –¥–æ—Å—Ç–æ–π–Ω–∞ –ù–æ–±–µ–ª–µ–≤—Å–∫–æ–π –ø—Ä–µ–º–∏–∏ –ø–æ –∏–¥–∏–æ—Ç–∏–∑–º—É.",
    "–¢—ã –∫–∞–∫ –ø–ª–æ—Ö–æ–π –∞–Ω–µ–∫–¥–æ—Ç ‚Äî –Ω–∏–∫—Ç–æ –Ω–µ —Å–º–µ—ë—Ç—Å—è, –∞ —Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞–µ—à—å —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å.",
    "–¢–≤–æ—è –ª–æ–≥–∏–∫–∞ –∫–∞–∫ –±—É—Ç–µ—Ä–±—Ä–æ–¥ ‚Äî –ø–∞–¥–∞–µ—Ç –º–∞—Å–ª–æ–º –≤–Ω–∏–∑, –≤—Å–µ–≥–¥–∞.",
    "–ï—Å–ª–∏ –±—ã —Ç–≤–æ—è –∂–∏–∑–Ω—å –±—ã–ª–∞ —Ñ–∏–ª—å–º–æ–º, —ç—Ç–æ –±—ã–ª –±—ã —Ç—Ä–∏–ª–ª–µ—Ä —Å –ø–ª–æ—Ö–∏–º –∫–æ–Ω—Ü–æ–º.",
    "–¢—ã –∫–∞–∫ —Å—Ç–∞—Ä—ã–π —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ ‚Äî —à—É–º–∏—Ç, –Ω–æ –Ω–∏—á–µ–≥–æ –ø–æ–ª–µ–∑–Ω–æ–≥–æ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç.",
    "–¢–≤–æ—ë —á—É–≤—Å—Ç–≤–æ —é–º–æ—Ä–∞ —É–º–µ—Ä–ª–æ –∏ –ø–æ—Ö–æ—Ä–æ–Ω–µ–Ω–æ –≥–ª—É–±–æ–∫–æ –≤ –±—É–Ω–∫–µ—Ä–µ.",
    "–¢—ã –∫–∞–∫ —à–∞—É—Ä–º–∞ –≤ —Ç—Ä–∏ —á–∞—Å–∞ –Ω–æ—á–∏ ‚Äî –≤—Ä–æ–¥–µ —Ö–æ—á–µ—Ç—Å—è, –Ω–æ –ø–æ—Ç–æ–º –∂–∞–ª–µ–µ—à—å.",
    "–ï—Å–ª–∏ –±—ã —Ç–≤–æ—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞ –±—ã–ª–∞ —Ä–∞–∑–º–µ—Ä–æ–º, –æ–Ω–∞ –±—ã –ø–æ–º–µ—Å—Ç–∏–ª–∞—Å—å –≤ –Ω–∞–ø–µ—Ä—Å—Ç–æ–∫.",
    "–¢—ã –∫–∞–∫ –¥–≤–µ—Ä—å –≤ –ø—É–±–ª–∏—á–Ω–æ–º —Ç—É–∞–ª–µ—Ç–µ ‚Äî —Ç–æ–ª–∫–Ω–µ—à—å, –∞ —Ç–∞–º —Ç–∞–∫–æ–µ...",
    "–¢–≤–æ–∏ –º–æ–∑–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–∞–∫ –º–µ–¥–ª–µ–Ω–Ω–æ, —á—Ç–æ —è –º–æ–≥ –±—ã –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –±—ã—Å—Ç—Ä–µ–µ.",
    "–¢—ã –∫–∞–∫ –º–µ–º —Å –∫–æ—Ç–∏–∫–æ–º ‚Äî –≤—Å–µ —Å–º–æ—Ç—Ä—è—Ç, –Ω–æ –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç, –ø–æ—á–µ–º—É —ç—Ç–æ —Å–º–µ—à–Ω–æ.",
    "–ï—Å–ª–∏ –±—ã —Ç—ã –±—ã–ª –ø—Ä–æ–≥—Ä–∞–º–º–æ–π, —Ç–µ–±—è –±—ã —É–¥–∞–ª–∏–ª–∏ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.",
    "–¢—ã –∫–∞–∫ –∑–æ–Ω—Ç–∏–∫ –≤ –ª–∏–≤–µ–Ω—å ‚Äî –ª–æ–º–∞–µ—Ç—Å—è –≤ —Å–∞–º—ã–π –Ω—É–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç.",
    "–¢–≤–æ—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤—Å—ë –ø–æ—Ä—Ç–∏—Ç—å ‚Äî —ç—Ç–æ —Ç–∞–ª–∞–Ω—Ç. –ó–ª–æ–π —Ç–∞–ª–∞–Ω—Ç.",
    "–¢—ã –∫–∞–∫ —à–Ω—É—Ä–∫–∏ ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–∑–≤—è–∑—ã–≤–∞–µ—à—å—Å—è –≤ —Å–∞–º—ã–π –Ω–µ—É–¥–æ–±–Ω—ã–π –º–æ–º–µ–Ω—Ç.",
    "–ï—Å–ª–∏ –±—ã –≥–ª—É–ø–æ—Å—Ç—å –±—ã–ª–∞ –∏—Å–∫—É—Å—Å—Ç–≤–æ–º, —Ç—ã –±—ã –ü–∏–∫–∞—Å—Å–æ. –ù–æ —ç—Ç–æ –Ω–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ.",
    "–¢—ã –∫–∞–∫ –±—É–º–∞–∂–∫–∞ ‚Äî –º–Ω—ë—Ç—Å—è –æ—Ç –ª—é–±–æ–≥–æ –¥—É–Ω–æ–≤–µ–Ω–∏—è, –∞ —Ç–æ–ª–∫—É –Ω–æ–ª—å.",
    "–¢–≤–æ—è –ª–æ–≥–∏–∫–∞ –∫–∞–∫ —ç–∫—Ä–∞–Ω —Ç–µ–ª–µ–≤–∏–∑–æ—Ä–∞ ‚Äî —á—ë—Ä–Ω—ã–π –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç.",
    "–¢—ã –∫–∞–∫ —Å–æ–ª–Ω—Ü–µ ‚Äî –≤—Å–µ –∑–Ω–∞—é—Ç, —á—Ç–æ —Ç—ã –µ—Å—Ç—å, –Ω–æ –Ω–∏–∫—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç –∫ —Ç–µ–±–µ.",
    "–ï—Å–ª–∏ –±—ã –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å –±—ã–ª–∞ –æ–ø—Ü–∏–µ–π, —Ç—ã –±—ã –≤—ã–±—Ä–∞–ª ¬´–≤—ã–∫–ª—é—á–µ–Ω–æ¬ª.",
    "–¢—ã –∫–∞–∫ –º–µ–¥—É–∑–∞ ‚Äî –º–µ–¥–ª–µ–Ω–Ω—ã–π, –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–π –∏ –∂–∂—ë—Ç—Å—è.",
    "–¢–≤–æ–∏ —Ä–µ—à–µ–Ω–∏—è —Ö—É–∂–µ, —á–µ–º –≥–æ—Ä–æ—Å–∫–æ–ø –≤ –¥–µ—à—ë–≤–æ–π –≥–∞–∑–µ—Ç–µ.",
    "–¢—ã –∫–∞–∫ –ª–æ–∂–∫–∞ ‚Äî –≤—Å–µ–≥–¥–∞ –æ–ø–∞–∑–¥—ã–≤–∞–µ—à—å, –∫–æ–≥–¥–∞ —Ç–µ–±—è –∏—â–µ—à—å.",
]

# ============== –°–ú–ï–®–ù–´–ï –ö–û–ú–ü–õ–ò–ú–ï–ù–¢–´ ==============
FUNNY_COMPLIMENTS = [
    "–¢—ã –∫–∞–∫ —Å–æ–ª–Ω—Ü–µ ‚Äî –¥–∞–∂–µ —á–µ—Ä–µ–∑ —Ç—É—á–∏ –ø—Ä–æ–±–∏–≤–∞–µ—à—å—Å—è –∏ –∑–∞—Å—Ç–∞–≤–ª—è–µ—à—å –≤—Å–µ—Ö —É–ª—ã–±–∞—Ç—å—Å—è!",
    "–¢–≤–æ—è —É–ª—ã–±–∫–∞ —è—Ä—á–µ, —á–µ–º –º–æ–π —ç–∫—Ä–∞–Ω –≤ —Ç—Ä–∏ —á–∞—Å–∞ –Ω–æ—á–∏. –°–µ—Ä—å—ë–∑–Ω–æ, —Ç—ã —Å–≤–µ—Ç–∏—à—å!",
    "–ï—Å–ª–∏ –±—ã —Ç—ã –±—ã–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º, —è –±—ã –ø–æ—Å—Ç–∞–≤–∏–ª 5 –∑–≤—ë–∑–¥ –∏ –Ω–∞–ø–∏—Å–∞–ª –≤–æ—Å—Ç–æ—Ä–∂–µ–Ω–Ω—ã–π –æ—Ç–∑—ã–≤!",
    "–¢—ã –∫–∞–∫ Wi-Fi ‚Äî –±–µ–∑ —Ç–µ–±—è –∂–∏–∑–Ω—å –±—ã–ª–∞ –±—ã –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ –∏ –ø–æ–ª–Ω–∞ –≥—Ä—É—Å—Ç–∏.",
    "–¢–≤–æ—ë —á—É–≤—Å—Ç–≤–æ —é–º–æ—Ä–∞ –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–∞–º—è—Ç–Ω–∏–∫–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞!",
    "–¢—ã –∫–∞–∫ –≥–æ—Ä—è—á–∏–π —à–æ–∫–æ–ª–∞–¥ –∑–∏–º–æ–π ‚Äî —Å–æ–≥—Ä–µ–≤–∞–µ—à—å, —Ä–∞–¥—É–µ—à—å –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –Ω–∞–¥–æ–µ–¥–∞–µ—à—å!",
    "–ï—Å–ª–∏ –±—ã –≤—Å–µ –ª—é–¥–∏ –±—ã–ª–∏ –∫–∞–∫ —Ç—ã, –≤ –º–∏—Ä–µ –±—ã –Ω–µ –±—ã–ª–æ –≤–æ–π–Ω, —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ü–µ—Ä—Ç—ã –∏ –≤–µ—á–µ—Ä–∏–Ω–∫–∏!",
    "–¢—ã –∫–∞–∫ –∏–¥–µ–∞–ª—å–Ω—ã–π –ø–ª–µ–π–ª–∏—Å—Ç ‚Äî –∫–∞–∂–¥–∞—è –ø–µ—Å–Ω—è –≤ —Ç–µ–º—É, –∏ —Ö–æ—á–µ—Ç—Å—è —Å–ª—É—à–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ!",
    "–¢–≤–æ—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ–¥–Ω–∏–º–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç –ù–æ–±–µ–ª–µ–≤—Å–∫–æ–π –ø—Ä–µ–º–∏–∏ –ø–æ —Ä–∞–¥–æ—Å—Ç–∏!",
    "–¢—ã –∫–∞–∫ –∫–æ—Ç –Ω–∞ –ø–æ–¥–æ–∫–æ–Ω–Ω–∏–∫–µ ‚Äî –º–∏–ª—ã–π, —Å–ø–æ–∫–æ–π–Ω—ã–π –∏ –¥–µ–ª–∞–µ—à—å –¥–µ–Ω—å –ª—É—á—à–µ –æ–¥–Ω–∏–º —Å–≤–æ–∏–º –≤–∏–¥–æ–º!",
    "–ï—Å–ª–∏ –±—ã —Ç–≤–æ—è –¥–æ–±—Ä–æ—Ç–∞ –±—ã–ª–∞ —ç–Ω–µ—Ä–≥–∏–µ–π, –º—ã –±—ã –∑–∞–±—ã–ª–∏ –ø—Ä–æ –≤—Å–µ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã!",
    "–¢—ã –∫–∞–∫ —Å–≤–µ–∂–µ–µ –ø–æ—Å—Ç–µ–ª—å–Ω–æ–µ –±–µ–ª—å—ë ‚Äî –ø–æ—Å–ª–µ –æ–±—â–µ–Ω–∏—è —Å —Ç–æ–±–æ–π —á—É–≤—Å—Ç–≤—É–µ—à—å —Å–µ–±—è –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º!",
    "–¢–≤–æ—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ, —á–µ–º –º–æ–π –±—É–¥–∏–ª—å–Ω–∏–∫ ‚Äî –≤—Å–µ–≥–¥–∞ –≤–æ–≤—Ä–µ–º—è –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–¥–≤–æ–¥–∏—Ç!",
    "–¢—ã –∫–∞–∫ –ª—É—á—à–∞—è –ø–µ—Å–Ω—è –≤ –º–æ–µ–π –≥–æ–ª–æ–≤–µ ‚Äî –∫—Ä—É—Ç–∏—à—å—Å—è –∏ –Ω–µ –¥–∞—ë—à—å –º–Ω–µ –≥—Ä—É—Å—Ç–∏—Ç—å!",
    "–ï—Å–ª–∏ –±—ã —Ç—ã –±—ã–ª —Å–ø–µ—Ü–∏–µ–π, —Ç—ã –±—ã–ª –±—ã –∫—É—Ä–∫—É–º–æ–π ‚Äî –ø–æ–ª–µ–∑–Ω—ã–π, —è—Ä–∫–∏–π –∏ –¥–µ–ª–∞–µ—à—å –≤—Å—ë –ª—É—á—à–µ!",
    "–¢—ã –∫–∞–∫ –ø—É—à–∏—Å—Ç—ã–π –ø–ª–µ–¥ –∑–∏–º–æ–π ‚Äî —É—é—Ç–Ω—ã–π, —Ç—ë–ø–ª—ã–π –∏ –æ—Ç —Ç–µ–±—è –Ω–µ —Ö–æ—á–µ—Ç—Å—è –æ—Ç—Ö–æ–¥–∏—Ç—å!",
    "–¢–≤–æ—ë —Ç–µ—Ä–ø–µ–Ω–∏–µ –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç –æ–ª–∏–º–ø–∏–π—Å–∫–æ–≥–æ –∑–æ–ª–æ—Ç–∞ –ø–æ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—é!",
    "–¢—ã –∫–∞–∫ –∑–æ–Ω—Ç–∏–∫ –≤ —Å–æ–ª–Ω–µ—á–Ω—ã–π –¥–µ–Ω—å ‚Äî –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ, –Ω–æ –ø—Ä–∏—è—Ç–Ω–æ, –∏ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ!",
    "–ï—Å–ª–∏ –±—ã —è –ø–∏—Å–∞–ª –∫–Ω–∏–≥—É –æ –∫—Ä—É—Ç—ã—Ö –ª—é–¥—è—Ö, —Ç—ã –±—ã–ª –±—ã –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ!",
    "–¢—ã –∫–∞–∫ —É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ—Ñ–µ ‚Äî –±–æ–¥—Ä–∏—à—å, —Ä–∞–¥—É–µ—à—å –∏ –¥–µ–ª–∞–µ—à—å —É—Ç—Ä–æ –≤–µ–ª–∏–∫–æ–ª–µ–ø–Ω—ã–º!",
    "–¢–≤–æ—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–∞—Ö–æ–¥–∏—Ç—å –≤—ã—Ö–æ–¥ —Ç–∞–º, –≥–¥–µ —è –≤–∏–∂—É —Å—Ç–µ–Ω—É, –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç –º–µ–Ω—è!",
    "–¢—ã –∫–∞–∫ –º–µ–º —Å –∫–æ—Ç–∏–∫–æ–º ‚Äî –≤—Å–µ —Å–º–æ—Ç—Ä—è—Ç –Ω–∞ —Ç–µ–±—è –∏ —É–ª—ã–±–∞—é—Ç—Å—è, –Ω–µ –ø–æ–Ω–∏–º–∞—è –ø–æ—á–µ–º—É!",
    "–ï—Å–ª–∏ –±—ã —Ç—ã –±—ã–ª –ø—Ä–æ–≥—Ä–∞–º–º–æ–π, —Ç—ã –±—ã–ª –±—ã –º–æ–∏–º –ª—é–±–∏–º—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º —Å –∏–¥–µ–∞–ª—å–Ω—ã–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º!",
    "–¢—ã –∫–∞–∫ –∞—Ä–æ–º–∞—Ç —Å–≤–µ–∂–µ–π –≤—ã–ø–µ—á–∫–∏ ‚Äî –ø—Ä–æ—Ö–æ–¥–∏—à—å –º–∏–º–æ –∏ —Å—Ä–∞–∑—É —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ö–æ—Ä–æ—à–æ!",
    "–¢–≤–æ—ë —á—É–≤—Å—Ç–≤–æ —Å—Ç–∏–ª—è –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –Ω–∞ YouTube —Å –º–∏–ª–ª–∏–æ–Ω–∞–º–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤!",
    "–¢—ã –∫–∞–∫ –∫–æ–º–ø–∞—Å –≤ –ª–µ—Å—É ‚Äî –±–µ–∑ —Ç–µ–±—è —è –±—ã —Ç–æ—á–Ω–æ –∑–∞–±–ª—É–¥–∏–ª—Å—è –∏ –≥—Ä—É—Å—Ç–∏–ª!",
    "–ï—Å–ª–∏ –±—ã —Ç–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è –±—ã–ª–∞ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ–º, —Ç—ã –±—ã –∑–∞–ø–∏—Ç–∞–ª —Ü–µ–ª—ã–π –≥–æ—Ä–æ–¥!",
    "–¢—ã –∫–∞–∫ –∏–¥–µ–∞–ª—å–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è ‚Äî –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π, –∫—Ä–∞—Å–∏–≤—ã–π –∏ —Ö–æ—á–µ—Ç—Å—è —Å–º–æ—Ç—Ä–µ—Ç—å –≤–µ—á–Ω–æ!",
    "–¢–≤–æ—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–ª—É—à–∞—Ç—å –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—ç—Ç–∫—É ¬´–õ—É—á—à–∏–π —Å–ª—É—à–∞—Ç–µ–ª—å –≥–æ–¥–∞¬ª!",
    "–¢—ã –∫–∞–∫ —Ç—ë–ø–ª–∞—è –≤–∞–Ω–Ω–∞ –ø–æ—Å–ª–µ –¥–æ–ª–≥–æ–≥–æ –¥–Ω—è ‚Äî —Ä–∞—Å—Å–ª–∞–±–ª—è–µ—à—å, —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—à—å –∏ –ª–µ—á–∏—à—å!",
    "–ï—Å–ª–∏ –±—ã —Ç—ã –±—ã–ª —Ü–≤–µ—Ç–∫–æ–º, —Ç—ã –±—ã–ª –±—ã –ø–æ–¥—Å–æ–ª–Ω—É—Ö–æ–º ‚Äî –≤—Å–µ–≥–¥–∞ —Å–º–æ—Ç—Ä–∏—à—å –Ω–∞ —Å–≤–µ—Ç –∏ –¥–∞—Ä–∏—à—å —Ä–∞–¥–æ—Å—Ç—å!",
    "–¢—ã –∫–∞–∫ –ª—É—á—à–∏–π –º–æ–º–µ–Ω—Ç –≤ —Ñ–∏–ª—å–º–µ ‚Äî —Ö–æ—á–µ—Ç—Å—è, —á—Ç–æ–±—ã –æ–Ω –¥–ª–∏–ª—Å—è –≤–µ—á–Ω–æ!",
    "–¢–≤–æ—ë –æ–±–∞—è–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ, —á–µ–º –º–æ–π –ø–∞—Ä–æ–ª—å –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ ‚Äî –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —É—Å—Ç–æ—è—Ç—å!",
    "–¢—ã –∫–∞–∫ –≤–æ–ª—à–µ–±–Ω–∞—è —Ç–∞–±–ª–µ—Ç–∫–∞ –æ—Ç –≥—Ä—É—Å—Ç–∏ ‚Äî –æ–¥–Ω–∞ —Ç–≤–æ—è —É–ª—ã–±–∫–∞ ‚Äî –∏ –≤—Å—ë —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ö–æ—Ä–æ—à–æ!",
    "–ï—Å–ª–∏ –±—ã —Ç—ã –±—ã–ª –∫–Ω–∏–≥–æ–π, —è –±—ã –ø—Ä–æ—á–∏—Ç–∞–ª —Ç–µ–±—è —Ç—ã—Å—è—á—É —Ä–∞–∑ –∏ –Ω–µ —É—Å—Ç–∞–ª!",
    "–¢—ã –∫–∞–∫ –ø–µ—Ä–≤–æ–µ —É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–ª–Ω—Ü–µ ‚Äî –Ω–µ–∂–Ω–æ–µ, —Ç—ë–ø–ª–æ–µ –∏ –æ–±–µ—â–∞–µ—Ç –æ—Ç–ª–∏—á–Ω—ã–π –¥–µ–Ω—å!",
    "–¢–≤–æ—ë –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –∂–∏–∑–Ω–∏ –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è!",
    "–¢—ã –∫–∞–∫ –ª—É—á—à–∏–π –¥—Ä—É–≥, –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ–≥–¥–∞ —Ä—è–¥–æ–º, –¥–∞–∂–µ –∫–æ–≥–¥–∞ —Ç—ã –¥–∞–ª–µ–∫–æ!",
    "–ï—Å–ª–∏ –±—ã —Ç–≤–æ–π –ø–æ–∑–∏—Ç–∏–≤ –±—ã–ª –≤–∏—Ä—É—Å–æ–º, —è –±—ã —Ö–æ—Ç–µ–ª –∑–∞—Ä–∞–∑–∏—Ç—å—Å—è –∏–º –Ω–∞–≤—Å–µ–≥–¥–∞!",
    "–¢—ã –∫–∞–∫ –∫–æ–Ω—Ü–µ—Ä—Ç –ª—é–±–∏–º–æ–π –≥—Ä—É–ø–ø—ã ‚Äî –≥—Ä–æ–º–∫–∏–π, —è—Ä–∫–∏–π –∏ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–µ —ç–º–æ—Ü–∏–∏!",
    "–¢–≤–æ—è –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å –æ—Å–ª–µ–ø–ª—è–µ—Ç –º–µ–Ω—è –∫–∞–∫ —Ñ–æ–Ω–∞—Ä–∏–∫ –≤ —Ç–µ–º–Ω–æ—Ç–µ ‚Äî —è—Ä–∫–æ –∏ —Ä–∞–¥–æ—Å—Ç–Ω–æ!",
    "–¢—ã –∫–∞–∫ –¥–æ–º–∞—à–Ω–∏–π —É—é—Ç –ø–æ—Å–ª–µ –¥–æ–ª–≥–æ–π –ø—Ä–æ–≥—É–ª–∫–∏ ‚Äî –∂–µ–ª–∞–Ω–Ω—ã–π, —Ç—ë–ø–ª—ã–π –∏ —É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∏–π!",
    "–ï—Å–ª–∏ –±—ã —Ç—ã –±—ã–ª —Å—É–ø–µ—Ä–≥–µ—Ä–æ–µ–º, —Ç–≤–æ—è —Å—É–ø–µ—Ä—Å–∏–ª–∞ –±—ã–ª–∞ –±—ã ‚Äî –¥–µ–ª–∞—Ç—å –≤—Å–µ—Ö —Å—á–∞—Å—Ç–ª–∏–≤—ã–º–∏!",
    "–¢—ã –∫–∞–∫ –∏–¥–µ–∞–ª—å–Ω—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç –≤ —Ä–µ—Ü–µ–ø—Ç–µ ‚Äî –±–µ–∑ —Ç–µ–±—è –±–ª—é–¥–æ –±—ã–ª–æ –±—ã –Ω–µ–ø–æ–ª–Ω—ã–º!",
    "–¢–≤–æ—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ, —á–µ–º –º–æ–π –ª—é–±–∏–º—ã–π –ø–ª–µ–π–ª–∏—Å—Ç –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫!",
    "–¢—ã –∫–∞–∫ —Ä–∞—Å—Å–≤–µ—Ç –ø–æ—Å–ª–µ –¥–æ–ª–≥–æ–π –Ω–æ—á–∏ ‚Äî –æ–±–µ—â–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ, —Å–≤–µ—Ç–ª–æ–≥–æ –∏ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–≥–æ!",
    "–ï—Å–ª–∏ –±—ã —Ç–≤–æ—è –¥–æ–±—Ä–æ—Ç–∞ –±—ã–ª–∞ –º—É–∑—ã–∫–æ–π, –æ–Ω–∞ –∑–≤—É—á–∞–ª–∞ –±—ã –∫–∞–∫ —Å–∏–º—Ñ–æ–Ω–∏—è angels!",
    "–¢—ã –∫–∞–∫ —Ç–æ—Ä—Ç –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è ‚Äî —Å–ª–∞–¥–∫–∏–π, –∂–µ–ª–∞–Ω–Ω—ã–π –∏ –¥–µ–ª–∞–µ—Ç –¥–µ–Ω—å –æ—Å–æ–±–µ–Ω–Ω—ã–º!",
    "–¢–≤–æ—ë —á—É–≤—Å—Ç–≤–æ —é–º–æ—Ä–∞ ‚Äî —ç—Ç–æ –∫–∞–∫ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç –≤ –º–æ—ë–º –ª—é–±–∏–º–æ–º –±–ª—é–¥–µ!",
    "–¢—ã –∫–∞–∫ –ª—É—á—à–∏–π –º–æ–º–µ–Ω—Ç –¥–Ω—è ‚Äî —Ö–æ—á–µ—Ç—Å—è, —á—Ç–æ–±—ã –æ–Ω –ø–æ–≤—Ç–æ—Ä—è–ª—Å—è —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞!",
]

user_anon_state = {}

# ============== –ù–û–ß–ù–´–ï –°–û–û–ë–©–ï–ù–ò–Ø ==============
NIGHT_WARNINGS = [
    "üåô –•–≤–∞—Ç–∏—Ç –ø–∏—Å–∞—Ç—å, —Å–ø–∞—Ç—å –ø–æ—Ä–∞! –¢–µ–ª–µ–ø—É–∑–∏–∫–∏ —É–∂–µ —É—Å–Ω—É–ª–∏!",
    "üò¥ –ù–∞—Ä–æ–¥, 22:00! –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ ‚Äî –≤—Ä–∞–≥ —Å–Ω–∞!",
    "üõèÔ∏è –≠–π, –≤—ã —Ç–∞–º! –ó–∞–≤—Ç—Ä–∞ –±–µ–≥–∞—Ç—å, –∞ –≤—ã –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ!",
    "üí§ –ö—Ç–æ –Ω–µ —Å–ø–∏—Ç ‚Äî —Ç–æ—Ç –Ω–µ –±–µ–≥–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ!",
    "üåÉ –ù–æ—á—å –Ω–∞ –¥–≤–æ—Ä–µ, –∞ –≤—ã –≤—Å—ë —á–∞—Ç–∏—Ç–µ—Å—å!",
    "üò± –í—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–≤—Ç—Ä–∞ –±–µ–≥–∞—Ç—å –∫–∞–∫ –∑–æ–º–±–∏?",
    "üé≠ –•–≤–∞—Ç–∏—Ç –∏–≥—Ä–∞—Ç—å –≤ –Ω–æ—á–Ω—ã—Ö –≥–µ—Ä–æ–µ–≤, –∏–¥–∏—Ç–µ —Å–ø–∞—Ç—å!",
    "üîÆ –í–æ–ª—à–µ–±—Å—Ç–≤–æ –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–≥–æ –±–µ–≥–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—à–µ–≥–æ —Å–Ω–∞!",
    "ü¶• –£—Ç—Ä–µ–Ω–Ω–∏–π –±–µ–≥ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –≤–µ—á–Ω–æ–≥–æ —Å–Ω–∞!",
    "üåü –ó–≤—ë–∑–¥—ã —É–∂–µ –≤—ã—à–ª–∏, –∞ –≤—ã –µ—â—ë –≤ —á–∞—Ç–µ!",
]

# ============== –ü–†–ò–í–ï–¢–°–¢–í–ò–Ø –í–û–ó–í–†–ê–©–ï–ù–¶–ï–í ==============
RETURN_GREETINGS = [
    "–û–æ–æ–æ, –∫–∞–∫–∏–µ –ª—é–¥–∏ –∏ –±–µ–∑ –æ—Ö—Ä–∞–Ω—ã! üï¥Ô∏è –° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, –±–æ—Å—Å!",
    "üéâ –û–≥–æ, –∫—Ç–æ —ç—Ç–æ –≤–µ—Ä–Ω—É–ª—Å—è! –ú—ã —É–∂–µ –∑–∞–±—ã–ª–∏, –∫–∞–∫ —Ç—ã –≤—ã–≥–ª—è–¥–∏—à—å!",
    "üòÆ –£—Ö —Ç—ã! –õ–µ–≥–µ–Ω–¥–∞ –æ–±—ä—è–≤–∏–ª–∞—Å—å! –ì–¥–µ —Ç—ã –±—ã–ª —Å—Ç–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏?",
    "üôå –°–º–æ—Ç—Ä–∏—Ç–µ-–∫–∞, –Ω–∞—à –≥–µ—Ä–æ–π —Å–Ω–æ–≤–∞ –≤ —Å—Ç—Ä–æ—é! –ü—Ä–æ–ø–∞–¥–∞–ª ‚Äî –Ω–µ–±–æ—Å—å, –º–∞—Ä–∞—Ñ–æ–Ω –±–µ–≥–∞–ª!",
    "üëÄ –ö—Ç–æ —ç—Ç–æ –ø–∏—à–µ—Ç? –ü—Ä–∏–∑—Ä–∞–∫ –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ! –° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º –≤ –º–∏—Ä –∂–∏–≤—ã—Ö!",
    "üöÄ –û–ø–∞-–Ω–∞! –ù–∞—à –∫–æ—Å–º–æ–Ω–∞–≤—Ç –ø—Ä–∏–∑–µ–º–ª–∏–ª—Å—è! –ö–∞–∫ —Ç–∞–º –≤ –æ—Ç–ø—É—Å–∫–µ –æ—Ç —á–∞—Ç–∞?",
    "üé© –ë–∞! –ë–∞! –ë–∞! –ö–∞–∫–∏–µ –≥–æ—Å—Ç–∏! –î–∞–≤–Ω–æ –Ω–µ –≤–∏–¥–µ–ª–∏—Å—å, –∞ —Ç—ã –≤—Å—ë –µ—â—ë –±–µ–≥–∞–µ—à—å?",
    "üòé –õ–µ–≥–µ–Ω–¥–∞ –≤ —á–∞—Ç–µ! –ú—ã —É–∂–µ —Ö–æ—Ç–µ–ª–∏ –≤–µ—à–∞—Ç—å —Ç–≤–æ–π –ø–æ—Ä—Ç—Ä–µ—Ç –Ω–∞ —Å—Ç–µ–Ω—É!",
    "üèÜ –û, –≤–µ–ª–∏–∫–∏–π –≤–µ—Ä–Ω—É–ª—Å—è! –ë–µ–∑ —Ç–µ–±—è —á–∞—Ç —Å–æ–≤—Å–µ–º —Å–∫—É—á–∞–ª (–Ω–µ—Ç)!",
    "üåü –°–≤–µ—Ç –º–æ–π, –≤–µ—Ä–Ω—É–ª—Å—è! –ó–∞–∂–¥–∞–ª–∏—Å—å –º—ã —Ç–µ–±—è, –∞–∂ 2 –Ω–µ–¥–µ–ª–∏ –ø—Ä–æ—à–ª–æ!",
    "üé™ –¶–∏—Ä–∫ –≤ –≥–æ—Ä–æ–¥–µ! –ó–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç—å –ø–æ—á—Ç–∏–ª–∞ –Ω–∞—Å —Å–≤–æ–∏–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ–º!",
    "ü§¥ –ü—Ä–∏–Ω—Ü –≤–µ—Ä–Ω—É–ª—Å—è –≤ –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ! –¢—Ä–æ–Ω –∂–¥—ë—Ç, –≤–∞—à–µ –≤–µ–ª–∏—á–µ—Å—Ç–≤–æ!",
    "ü¶Å –¶–∞—Ä—å –ª–µ—Å–æ–≤ –æ–±—ä—è–≤–∏–ª—Å—è! –ü—Ä–æ–ø–∞–¥–∞–ª ‚Äî –æ—Ö–æ—Ç–∏–ª—Å—è –Ω–∞ –º–∞—Ä–∞—Ñ–æ–Ω—ã?",
    "üé∏ –†–æ–∫-–∑–≤–µ–∑–¥–∞ –≤ —á–∞—Ç–µ! –ì–¥–µ –±—ã–ª –Ω–∞ –≥–∞—Å—Ç—Ä–æ–ª—è—Ö, –≤ –±–µ–≥–µ –ø–æ –±–∞—Ä—Ö–∞–Ω–∞–º?",
    "üëë –ö–æ—Ä–æ–Ω–∞ —É–ø–∞–ª–∞! –ö–æ—Ä–æ–ª—å –≤–µ—Ä–Ω—É–ª—Å—è –Ω–∞ —Ç—Ä–æ–Ω! –° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º!",
    "üßô –ú–∞–≥ –≤–µ—Ä–Ω—É–ª—Å—è –∏–∑ –∑–∞—Ç–æ—á–µ–Ω–∏—è! –ß–∞—Ä—ã —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç?",
    "ü¶∏ –°—É–ø–µ—Ä–≥–µ—Ä–æ–π —Å–ø–∞—Å –º–∏—Ä –∏ –≤–µ—Ä–Ω—É–ª—Å—è! –ö–∞–∫ —Ç–∞–º, –º–Ω–æ–≥–æ –∑–ª–∞ –ø–æ–±–µ–¥–∏–ª?",
    "üé≠ –ê–∫—Ç—ë—Ä –≤—ã—à–µ–ª –Ω–∞ —Å—Ü–µ–Ω—É! –î–∞–≤–Ω–æ –Ω–µ –±—ã–ª–∏ –≤ –≥–ª–∞–≤–Ω–æ–π —Ä–æ–ª–∏!",
    "üê≤ –î—Ä–∞–∫–æ–Ω –∏–∑ –ø–µ—â–µ—Ä—ã –≤—ã–ø–æ–ª–∑! –ì–¥–µ –ø—Ä—è—Ç–∞–ª—Å—è –æ—Ç –±–µ–≥–æ–≤—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫?",
    "ü¶Ö –û—Ä—ë–ª –ø—Ä–∏–ª–µ—Ç–µ–ª! –í—ã—Å–æ–∫–æ –ø–∞—Ä–∏–ª –Ω–∞–¥ –Ω–∞–º–∏ –≤—Å–µ —ç—Ç–∏ –¥–Ω–∏?",
]


# ============== –ü–û–ì–û–î–ê ==============
async def get_weather() -> str:
    try:
        async with httpx.AsyncClient() as client:
            moscow_response = await client.get(
                "https://api.open-meteo.com/v1/forecast",
                params={
                    "latitude": 55.7558,
                    "longitude": 37.6173,
                    "current_weather": "true",
                },
                timeout=10.0,
            )
            spb_response = await client.get(
                "https://api.open-meteo.com/v1/forecast",
                params={
                    "latitude": 59.9343,
                    "longitude": 30.3351,
                    "current_weather": "true",
                },
                timeout=10.0,
            )

            moscow_data = moscow_response.json()
            spb_data = spb_response.json()

            moscow_temp = moscow_data["current_weather"]["temperature"]
            moscow_wind = moscow_data["current_weather"]["windspeed"]
            spb_temp = spb_data["current_weather"]["temperature"]
            spb_wind = spb_data["current_weather"]["windspeed"]

            weather_text = (
                f"üå§ **–ü–æ–≥–æ–¥–∞ —É—Ç—Ä–æ–º:**\n"
                f"üèô –ú–æ—Å–∫–≤–∞: **{moscow_temp}¬∞C**, –≤–µ—Ç–µ—Ä {moscow_wind} –∫–º/—á\n"
                f"üåÜ –°–ü–±: **{spb_temp}¬∞C**, –≤–µ—Ç–µ—Ä {spb_wind} –∫–º/—á"
            )
            return weather_text
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã: {e}")
        return "üå§ –ü–æ–≥–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"


# ============== –£–¢–†–ï–ù–ù–ï–ï –ü–†–ò–í–ï–¢–°–¢–í–ò–ï ==============
def get_day_theme() -> str:
    now = datetime.now(MOSCOW_TZ)
    day_name_en = now.strftime("%A")
    return DAY_THEMES.get(day_name_en, "üåü –û—Ç–ª–∏—á–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –ø—Ä–æ–±–µ–∂–∫–∏!")


def get_random_welcome() -> str:
    return random.choice(WELCOME_MESSAGES)


def get_random_motivation() -> str:
    return random.choice(MOTIVATION_QUOTES)


def get_random_insult() -> str:
    return random.choice(FUNNY_INSULTS)


def get_random_compliment() -> str:
    return random.choice(FUNNY_COMPLIMENTS)


# ============== –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–ï –°–¢–ê–¢–ò–°–¢–ò–ö–ò ==============
def update_daily_stats(user_id: int, user_name: str, message_type: str, photo_info: dict = None):
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
    global daily_stats
    
    today = datetime.now(MOSCOW_TZ).strftime("%Y-%m-%d")
    
    # –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –¥–Ω—è
    if daily_stats["date"] != today:
        daily_stats = {
            "date": today,
            "total_messages": 0,
            "user_messages": {},
            "photos": [],
        }
    
    daily_stats["total_messages"] += 1
    
    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if user_id not in daily_stats["user_messages"]:
        daily_stats["user_messages"][user_id] = {
            "name": user_name,
            "count": 0,
        }
    daily_stats["user_messages"][user_id]["count"] += 1
    
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    if message_type == "photo" and photo_info:
        daily_stats["photos"].append(photo_info)


# ============== –†–ê–°–ß–Å–¢ –†–ï–ô–¢–ò–ù–ì–ê ==============
def calculate_user_rating(user_id: int) -> int:
    """–†–∞—Å—á—ë—Ç –æ–±—â–µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    if user_id not in user_rating_stats:
        return 0
    
    stats = user_rating_stats[user_id]
    
    messages_points = stats["messages"] // POINTS_PER_MESSAGES
    photos_points = stats["photos"] // POINTS_PER_PHOTOS
    likes_points = stats["likes"] // POINTS_PER_LIKES
    replies_points = stats["replies"]  # –ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç = 1 –±–∞–ª–ª
    
    return messages_points + photos_points + likes_points + replies_points


def get_user_level(user_id: int) -> str:
    """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —É—á–∞—Å—Ç–Ω–∏–∫–∞"""
    total_points = calculate_user_rating(user_id)
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å –ø–æ –æ—á–∫–∞–º (–æ—Ç –≤—ã—Å–æ–∫–æ–≥–æ –∫ –Ω–∏–∑–∫–æ–º—É)
    if total_points >= USER_LEVELS["–õ–µ–≥–µ–Ω–¥–∞ —á–∞—Ç–∞"]:
        return "–õ–µ–≥–µ–Ω–¥–∞ —á–∞—Ç–∞"
    elif total_points >= USER_LEVELS["–õ–∏–¥–µ—Ä"]:
        return "–õ–∏–¥–µ—Ä"
    elif total_points >= USER_LEVELS["–ê–∫—Ç–∏–≤–Ω—ã–π"]:
        return "–ê–∫—Ç–∏–≤–Ω—ã–π"
    else:
        return "–ù–æ–≤–∏—á–æ–∫"


def get_rating_details(user_id: int) -> dict:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞"""
    if user_id not in user_rating_stats:
        return {
            "name": "Unknown",
            "messages": 0,
            "photos": 0,
            "likes": 0,
            "replies": 0,
            "total_points": 0,
            "level": "–ù–æ–≤–∏—á–æ–∫"
        }
    
    stats = user_rating_stats[user_id]
    level = get_user_level(user_id)
    
    return {
        "name": stats["name"],
        "messages": stats["messages"],
        "photos": stats["photos"],
        "likes": stats["likes"],
        "replies": stats["replies"],
        "total_points": calculate_user_rating(user_id),
        "level": level
    }


async def send_point_notification(user_name: str, points: int, reason: str, total_points: int):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –ø—É–±–ª–∏—á–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–ª—É—á–µ–Ω–∏–∏ –±–∞–ª–ª–æ–≤"""
    if application is None:
        return
    
    try:
        # –≠–º–æ–¥–∑–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–∏—á–∏–Ω—ã –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–ª–æ–≤
        reason_emojis = {
            "—Å–æ–æ–±—â–µ–Ω–∏—è": "üí¨",
            "—Ñ–æ—Ç–æ": "üì∑",
            "–ª–∞–π–∫–∏": "‚ù§Ô∏è",
            "–æ—Ç–≤–µ—Ç—ã": "üí¨"
        }
        
        emoji = reason_emojis.get(reason, "‚≠ê")
        
        notification_text = (
            f"{emoji} **{user_name}** –ø–æ–ª—É—á–∏–ª(–∞) +{points} –±–∞–ª–ª(–æ–≤) –∑–∞ {reason}!\n"
            f"üìä –í—Å–µ–≥–æ –±–∞–ª–ª–æ–≤: **{total_points}**"
        )
        
        await application.bot.send_message(
            chat_id=CHAT_ID,
            text=notification_text,
            parse_mode="Markdown",
        )
        
        logger.info(f"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –±–∞–ª–ª–∞—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {user_name} +{points}")
        
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –±–∞–ª–ª–∞—Ö: {e}")


async def send_level_up_notification(user_name: str, new_level: str):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è"""
    if application is None:
        return
    
    try:
        level_emoji = LEVEL_EMOJIS.get(new_level, "‚≠ê")
        
        level_messages = {
            "–ê–∫—Ç–∏–≤–Ω—ã–π": f"üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! **{user_name}** –ø–µ—Ä–µ—à—ë–ª –≤ —Ä—è–¥—ã **–ê–∫—Ç–∏–≤–Ω—ã—Ö** –±–µ–≥—É–Ω–æ–≤!",
            "–õ–∏–¥–µ—Ä": f"üëë –£—Ä–∞! **{user_name}** —Å—Ç–∞–ª **–õ–∏–¥–µ—Ä–æ–º** –±–µ–≥–æ–≤–æ–≥–æ —á–∞—Ç–∞!",
            "–õ–µ–≥–µ–Ω–¥–∞ —á–∞—Ç–∞": f"üèÜ –û–ì–û! **{user_name}** –¥–æ—Å—Ç–∏–≥ –∑–≤–∞–Ω–∏—è **–õ–µ–≥–µ–Ω–¥—ã —á–∞—Ç–∞**! –≠—Ç–æ –≤–µ—Ä—à–∏–Ω–∞!"
        }
        
        notification_text = level_messages.get(new_level, f"üéä **{user_name}** –ø–æ–≤—ã—Å–∏–ª(–∞) —É—Ä–æ–≤–µ–Ω—å –¥–æ **{new_level}**!")
        
        await application.bot.send_message(
            chat_id=CHAT_ID,
            text=notification_text,
            parse_mode="Markdown",
        )
        
        logger.info(f"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è: {user_name} -> {new_level}")
        
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —É—Ä–æ–≤–Ω–µ: {e}")


def update_rating_stats(user_id: int, user_name: str, category: str, amount: int = 1) -> tuple:
    """
    –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –Ω–∞–∫—Ä—É—Ç–æ–∫
    
    Returns: (success: bool, points_earned: int, message: str)
    """
    global user_rating_stats, user_current_level, user_message_times
    
    now = datetime.now(MOSCOW_TZ)
    today = now.strftime("%Y-%m-%d")
    current_time = now.timestamp()
    
    # –ó–ê–©–ò–¢–ê 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ñ–ª—É–¥ —Å–æ–æ–±—â–µ–Ω–∏–π
    if category == "messages":
        if user_id not in user_message_times:
            user_message_times[user_id] = []
        
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ (—Å—Ç–∞—Ä—à–µ 1 –º–∏–Ω—É—Ç—ã)
        user_message_times[user_id] = [
            t for t in user_message_times[user_id] 
            if current_time - t < 60
        ]
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É
        if len(user_message_times[user_id]) >= MAX_MESSAGES_PER_MINUTE:
            logger.info(f"–ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞: {user_name} –ø—Ä–µ–≤—ã—Å–∏–ª –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π")
            return False, 0, "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π!"
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        user_message_times[user_id].append(current_time)
    
    # –ó–ê–©–ò–¢–ê 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –≤ —á–∞—Å
    if user_id in user_rating_stats:
        # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –±–∞–ª–ª—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
        # (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - —Å—á–∏—Ç–∞–µ–º –ø–æ –æ–±—â–∏–º –¥–∞–Ω–Ω—ã–º)
        recent_points = (
            user_rating_stats[user_id]["messages"] // POINTS_PER_MESSAGES +
            user_rating_stats[user_id]["photos"] // POINTS_PER_PHOTOS +
            user_rating_stats[user_id]["likes"] // POINTS_PER_LIKES +
            user_rating_stats[user_id]["replies"]
        )
        
        # –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –º–Ω–æ–≥–æ –±–∞–ª–ª–æ–≤, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º (—ç—Ç–æ –Ω–µ —Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
        # –î–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –Ω–∞–∫—Ä—É—Ç–æ–∫ –¥–æ–±–∞–≤–∏–º –∑–∞–¥–µ—Ä–∂–∫—É –≤ –ª–æ–≥–∏–∫—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if user_id not in user_rating_stats:
        user_rating_stats[user_id] = {
            "name": user_name,
            "messages": 0,
            "photos": 0,
            "likes": 0,
            "replies": 0,
            "last_update": today
        }
        user_current_level[user_id] = "–ù–æ–≤–∏—á–æ–∫"
    
    # –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —Å—Ç–∞—Ä—ã–π —É—Ä–æ–≤–µ–Ω—å
    old_level = user_current_level.get(user_id, "–ù–æ–≤–∏—á–æ–∫")
    
    # –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –ø—Ä–∏—Ä–æ—Å—Ç–∞
    old_messages = user_rating_stats[user_id]["messages"]
    old_photos = user_rating_stats[user_id]["photos"]
    old_likes = user_rating_stats[user_id]["likes"]
    old_replies = user_rating_stats[user_id]["replies"]
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    user_rating_stats[user_id][category] += amount
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–∫–æ–ª—å–∫–æ –±–∞–ª–ª–æ–≤ –Ω–∞—á–∏—Å–ª–µ–Ω–æ –∑–∞ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ (–ø—Ä–∏—Ä–æ—Å—Ç)
    points_earned = 0
    if category == "messages":
        new_messages = user_rating_stats[user_id]["messages"]
        points_earned = (new_messages // POINTS_PER_MESSAGES) - (old_messages // POINTS_PER_MESSAGES)
    elif category == "photos":
        new_photos = user_rating_stats[user_id]["photos"]
        points_earned = (new_photos // POINTS_PER_PHOTOS) - (old_photos // POINTS_PER_PHOTOS)
    elif category == "likes":
        new_likes = user_rating_stats[user_id]["likes"]
        points_earned = (new_likes // POINTS_PER_LIKES) - (old_likes // POINTS_PER_LIKES)
    elif category == "replies":
        new_replies = user_rating_stats[user_id]["replies"]
        points_earned = new_replies - old_replies  # –ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç = 1 –±–∞–ª–ª
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å
    new_level = get_user_level(user_id)
    user_current_level[user_id] = new_level
    
    return True, points_earned, "OK"


async def send_morning_greeting():
    global morning_message_id

    if application is None:
        logger.error("Application –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
        return

    try:
        weather = await get_weather()
        theme = get_day_theme()
        motivation = get_random_motivation()

        greeting_text = (
            f"üåÖ **–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –±–µ–≥—É–Ω—ã!** üèÉ‚Äç‚ôÇÔ∏è\n\n"
            f"{weather}\n\n"
            f"{theme}\n\n"
            f"{motivation}\n\n"
            f"üí≠ *–ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–∏ –ø–ª–∞–Ω—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è!*"
        )

        message = await application.bot.send_message(
            chat_id=CHAT_ID,
            text=greeting_text,
            parse_mode="Markdown",
        )

        morning_message_id = message.message_id
        logger.info(f"–£—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {morning_message_id}")

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")


async def morning_scheduler_task():
    global morning_scheduled_date

    while bot_running:
        now = datetime.now(MOSCOW_TZ)
        current_hour = now.hour
        current_minute = now.minute
        today_date = now.strftime("%Y-%m-%d")

        if current_hour == 6 and current_minute == 0:
            if morning_scheduled_date != today_date:
                logger.info("–í—Ä–µ–º—è 6:00 - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ")
                try:
                    await send_morning_greeting()
                    morning_scheduled_date = today_date
                    logger.info("–£—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ")
                except Exception as e:
                    logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: {e}")

        await asyncio.sleep(60)


# ============== –ú–û–¢–ò–í–ê–¶–ò–û–ù–ù–´–ï –°–û–û–ë–©–ï–ù–ò–Ø ==============
async def send_motivation():
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è"""
    if application is None:
        return

    try:
        motivation = get_random_motivation()
        message = await application.bot.send_message(
            chat_id=CHAT_ID,
            text=f"üí™ {motivation}",
            parse_mode="Markdown",
        )
        logger.info(f"–ú–æ—Ç–∏–≤–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: {message.message_id}")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–æ—Ç–∏–≤–∞—Ü–∏–∏: {e}")


async def motivation_scheduler_task():
    """–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ 11:00, 16:00, 21:00"""
    global motivation_sent_times
    
    while bot_running:
        now = datetime.now(MOSCOW_TZ)
        current_hour = now.hour
        current_minute = now.minute
        today_date = now.strftime("%Y-%m-%d")
        
        # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø–æ–ª–Ω–æ—á—å
        if now.hour == 0 and current_minute == 0:
            motivation_sent_times = []
        
        # –í—Ä–µ–º—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–æ—Ç–∏–≤–∞—Ü–∏–∏
        motivation_hours = [11, 16, 21]  # 11:00, 16:00, 21:00
        
        for hour in motivation_hours:
            if current_hour == hour and current_minute == 0:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ –ª–∏ —É–∂–µ —Å–µ–≥–æ–¥–Ω—è –≤ —ç—Ç–æ –≤—Ä–µ–º—è
                key = f"{today_date}_{hour}"
                if key not in motivation_sent_times:
                    logger.info(f"–í—Ä–µ–º—è {hour}:00 - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–æ—Ç–∏–≤–∞—Ü–∏—é")
                    try:
                        await send_motivation()
                        motivation_sent_times.append(key)
                        logger.info("–ú–æ—Ç–∏–≤–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞")
                    except Exception as e:
                        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –º–æ—Ç–∏–≤–∞—Ü–∏–∏: {e}")
        
        await asyncio.sleep(60)


# ============== –ï–ñ–ï–î–ù–ï–í–ù–ê–Ø –°–í–û–î–ö–ê ==============
async def get_top_liked_photos() -> list:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ø —Ñ–æ—Ç–æ –ø–æ –ª–∞–π–∫–∞–º —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏"""
    global daily_stats, user_rating_stats, user_current_level
    
    if not daily_stats["photos"]:
        return []
    
    try:
        # –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ—Ç–æ –∏ –æ–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥
        updated_photos = []
        for photo in daily_stats["photos"]:
            try:
                reactions = await application.bot.get_message_reactions(
                    chat_id=CHAT_ID,
                    message_id=photo["message_id"],
                )
                # –°—á–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ reaction "üëç" (thumbs up)
                like_count = 0
                for reaction in reactions:
                    for choice in reaction.choices:
                        if choice.emoji == "üëç":
                            like_count = choice.count
                            break
                
                # –û–±–Ω–æ–≤–ª—è–µ–º –ª–∞–π–∫–∏ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ –∞–≤—Ç–æ—Ä–∞ —Ñ–æ—Ç–æ
                if like_count > 0 and photo["user_id"] in user_rating_stats:
                    old_likes = user_rating_stats[photo["user_id"]]["likes"]
                    user_rating_stats[photo["user_id"]]["likes"] = like_count
                    
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–∫–æ–ª—å–∫–æ –±–∞–ª–ª–æ–≤ –∑–∞ –ª–∞–π–∫–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–æ
                    old_points = old_likes // POINTS_PER_LIKES
                    new_points = like_count // POINTS_PER_LIKES
                    points_earned = new_points - old_points
                    
                    if points_earned > 0:
                        photo_author_name = user_rating_stats[photo["user_id"]]["name"]
                        total = calculate_user_rating(photo["user_id"])
                        await send_point_notification(photo_author_name, points_earned, "–ª–∞–π–∫–∏", total)
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
                        new_level = get_user_level(photo["user_id"])
                        old_level = user_current_level.get(photo["user_id"], "–ù–æ–≤–∏—á–æ–∫")
                        if new_level != old_level and new_level != "–ù–æ–≤–∏—á–æ–∫":
                            user_current_level[photo["user_id"]] = new_level
                            await send_level_up_notification(photo_author_name, new_level)
                
                updated_photos.append({
                    "file_id": photo["file_id"],
                    "user_id": photo["user_id"],
                    "likes": like_count,
                    "message_id": photo["message_id"],
                })
            except Exception:
                # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ª–∞–π–∫–∏, —Å—á–∏—Ç–∞–µ–º –∫–∞–∫ 0
                updated_photos.append({
                    "file_id": photo["file_id"],
                    "user_id": photo["user_id"],
                    "likes": 0,
                    "message_id": photo["message_id"],
                })
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ª–∞–π–∫–∞–º –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ–º (–º–∏–Ω–∏–º—É–º 4)
        updated_photos.sort(key=lambda x: x["likes"], reverse=True)
        top_photos = [p for p in updated_photos if p["likes"] >= 4]
        
        return top_photos[:2]  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞–∫—Å–∏–º—É–º 2 —Ñ–æ—Ç–æ
        
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–ø —Ñ–æ—Ç–æ: {e}")
        return []


async def get_top_users() -> list:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ø 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º"""
    global daily_stats
    
    if not daily_stats["user_messages"]:
        return []
    
    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–æ–æ–±—â–µ–Ω–∏–π
    sorted_users = sorted(
        daily_stats["user_messages"].items(),
        key=lambda x: x[1]["count"],
        reverse=True
    )
    
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ø 5
    return [(user_id, data["name"], data["count"]) for user_id, data in sorted_users[:5]]


async def get_top_rated_users() -> list:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ø 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É"""
    global user_rating_stats
    
    if not user_rating_stats:
        return []
    
    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ–±—â–µ–º—É —Ä–µ–π—Ç–∏–Ω–≥—É
    rated_users = []
    for user_id, stats in user_rating_stats.items():
        total_points = calculate_user_rating(user_id)
        level = get_user_level(user_id)
        rated_users.append({
            "user_id": user_id,
            "name": stats["name"],
            "points": total_points,
            "messages": stats["messages"],
            "photos": stats["photos"],
            "likes": stats["likes"],
            "replies": stats["replies"],
            "level": level
        })
    
    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ—á–∫–∞–º (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
    rated_users.sort(key=lambda x: x["points"], reverse=True)
    
    return rated_users[:10]


async def send_daily_summary():
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Å–≤–æ–¥–∫–∏"""
    global daily_summary_sent
    
    if application is None:
        logger.error("Application –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
        return
    
    if daily_summary_sent:
        logger.info("–°–≤–æ–¥–∫–∞ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–µ–≥–æ–¥–Ω—è")
        return
    
    try:
        today = datetime.now(MOSCOW_TZ).strftime("%Y-%m-%d")
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å–≤–æ–¥–∫–∏
        summary_text = f"üìä **–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞ –∑–∞ {today}**\n\n"
        
        # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
        summary_text += f"üí¨ **–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π:** {daily_stats['total_messages']}\n\n"
        
        # –¢–æ–ø –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        top_users = await get_top_users()
        if top_users:
            summary_text += "üèÜ **–¢–æ–ø –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–µ–≥—É–Ω–æ–≤:**\n"
            medals = ["ü•á", "ü•à", "ü•â", "4Ô∏è‚É£", "5Ô∏è‚É£"]
            for i, (user_id, name, count) in enumerate(top_users):
                summary_text += f"{medals[i]} {name} ‚Äî {count} —Å–æ–æ–±—â–µ–Ω–∏–π\n"
            summary_text += "\n"
        else:
            summary_text += "üèÜ **–¢–æ–ø –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–µ–≥—É–Ω–æ–≤:** –ü–æ–∫–∞ –Ω–∏–∫–æ–≥–æ –Ω–µ—Ç\n\n"
        
        # –†–µ–π—Ç–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        top_rated = await get_top_rated_users()
        if top_rated:
            summary_text += "‚≠ê **–†–µ–π—Ç–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (—Ç–æ–ø-10):**\n"
            medals_rating = ["ü•á", "ü•à", "ü•â", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£", "8Ô∏è‚É£", "9Ô∏è‚É£", "üîü"]
            for i, user in enumerate(top_rated):
                level_emoji = LEVEL_EMOJIS.get(user["level"], "")
                summary_text += f"{medals_rating[i]} {level_emoji} {user['name']} ‚Äî {user['points']} –æ—á–∫–æ–≤"
                # –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏
                details = []
                if user['messages'] > 0:
                    msg_pts = user['messages'] // POINTS_PER_MESSAGES
                    details.append(f"üìù{msg_pts}")
                if user['photos'] > 0:
                    photo_pts = user['photos'] // POINTS_PER_PHOTOS
                    details.append(f"üì∑{photo_pts}")
                if user['likes'] > 0:
                    like_pts = user['likes'] // POINTS_PER_LIKES
                    details.append(f"‚ù§Ô∏è{like_pts}")
                if user['replies'] > 0:
                    details.append(f"üí¨{user['replies']}")
                if details:
                    summary_text += f" ({', '.join(details)})"
                summary_text += "\n"
        else:
            summary_text += "‚≠ê **–†–µ–π—Ç–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:** –ü–æ–∫–∞ –Ω–∏–∫–æ–≥–æ –Ω–µ—Ç\n\n"
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—É—é —á–∞—Å—Ç—å
        await application.bot.send_message(
            chat_id=CHAT_ID,
            text=summary_text,
            parse_mode="Markdown",
        )
        
        # –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–ø —Ñ–æ—Ç–æ —Å 4+ –ª–∞–π–∫–∞–º–∏
        try:
            top_photos = await get_top_liked_photos()
            if top_photos:
                for photo in top_photos:
                    try:
                        await application.bot.send_photo(
                            chat_id=CHAT_ID,
                            photo=photo["file_id"],
                            caption=f"‚ù§Ô∏è {photo['likes']} –ª–∞–π–∫–æ–≤",
                        )
                    except Exception:
                        pass
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–æ—Ç–æ: {e}")
        
        daily_summary_sent = True
        logger.info("–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞")
        
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Å–≤–æ–¥–∫–∏: {e}")


# ============== –ï–ñ–ï–ù–ï–î–ï–õ–¨–ù–ê–Ø –°–í–û–î–ö–ê ==============
async def send_weekly_summary():
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–π —Å–≤–æ–¥–∫–∏ –ø–æ —É—Ä–æ–≤–Ω—è–º"""
    if application is None:
        logger.error("Application –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
        return
    
    try:
        now = datetime.now(MOSCOW_TZ)
        week_num = now.isocalendar()[1]
        year = now.year
        
        weekly_text = f"üåü **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞ (–ù–µ–¥–µ–ª—è #{week_num}, {year})**\n\n"
        
        # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º
        levels_summary = {
            "–õ–µ–≥–µ–Ω–¥–∞ —á–∞—Ç–∞": [],
            "–õ–∏–¥–µ—Ä": [],
            "–ê–∫—Ç–∏–≤–Ω—ã–π": [],
            "–ù–æ–≤–∏—á–æ–∫": []
        }
        
        for user_id, stats in user_rating_stats.items():
            level = get_user_level(user_id)
            total_points = calculate_user_rating(user_id)
            levels_summary[level].append({
                "name": stats["name"],
                "points": total_points,
                "level": level
            })
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è –ø–æ –æ—á–∫–∞–º
        for level in levels_summary:
            levels_summary[level].sort(key=lambda x: x["points"], reverse=True)
        
        # –í—ã–≤–æ–¥–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º (–æ—Ç –≤—ã—Å–æ–∫–æ–≥–æ –∫ –Ω–∏–∑–∫–æ–º—É)
        level_order = ["–õ–µ–≥–µ–Ω–¥–∞ —á–∞—Ç–∞", "–õ–∏–¥–µ—Ä", "–ê–∫—Ç–∏–≤–Ω—ã–π", "–ù–æ–≤–∏—á–æ–∫"]
        
        for level in level_order:
            users = levels_summary[level]
            if users:
                level_emoji = LEVEL_EMOJIS.get(level, "")
                weekly_text += f"{level_emoji} **{level}** ({len(users)} —á–µ–ª.):\n"
                
                # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ø-3 –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
                top_users = users[:3]
                medals = ["ü•á", "ü•à", "ü•â"]
                for i, user in enumerate(top_users):
                    weekly_text += f"   {medals[i]} {user['name']} ‚Äî {user['points']} –æ—á–∫–æ–≤\n"
                
                if len(users) > 3:
                    weekly_text += f"   ... –∏ –µ—â—ë {len(users) - 3} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n"
                
                weekly_text += "\n"
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        total_messages = sum(stats["messages"] for stats in user_rating_stats.values())
        total_photos = sum(stats["photos"] for stats in user_rating_stats.values())
        total_likes = sum(stats["likes"] for stats in user_rating_stats.values())
        total_replies = sum(stats["replies"] for stats in user_rating_stats.values())
        
        weekly_text += "üìä **–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ–¥–µ–ª–∏:**\n"
        weekly_text += f"üí¨ –°–æ–æ–±—â–µ–Ω–∏–π: {total_messages}\n"
        weekly_text += f"üì∑ –§–æ—Ç–æ: {total_photos}\n"
        weekly_text += f"‚ù§Ô∏è –õ–∞–π–∫–æ–≤: {total_likes}\n"
        weekly_text += f"üí¨ –û—Ç–≤–µ—Ç–æ–≤: {total_replies}\n\n"
        
        # –ö–∞–∫ –ø–æ–≤—ã—Å–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å
        weekly_text += "üìà **–ö–∞–∫ –ø–æ–≤—ã—Å–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å:**\n"
        weekly_text += f"üå± ‚Üí ‚≠ê (–ù–æ–≤–∏—á–æ–∫ ‚Üí –ê–∫—Ç–∏–≤–Ω—ã–π): **{USER_LEVELS['–ê–∫—Ç–∏–≤–Ω—ã–π']}** –æ—á–∫–æ–≤\n"
        weekly_text += f"‚≠ê ‚Üí üëë (–ê–∫—Ç–∏–≤–Ω—ã–π ‚Üí –õ–∏–¥–µ—Ä): **{USER_LEVELS['–õ–∏–¥–µ—Ä']}** –æ—á–∫–æ–≤\n"
        weekly_text += f"üëë ‚Üí üèÜ (–õ–∏–¥–µ—Ä ‚Üí –õ–µ–≥–µ–Ω–¥–∞): **{USER_LEVELS['–õ–µ–≥–µ–Ω–¥–∞ —á–∞—Ç–∞']}** –æ—á–∫–æ–≤\n"
        
        await application.bot.send_message(
            chat_id=CHAT_ID,
            text=weekly_text,
            parse_mode="Markdown",
        )
        
        logger.info("–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞")
        
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–π —Å–≤–æ–¥–∫–∏: {e}")


# ============== –ï–ñ–ï–ú–ï–°–Ø–ß–ù–ê–Ø –°–í–û–î–ö–ê ==============
async def send_monthly_summary():
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –µ–∂–µ–º–µ—Å—è—á–Ω–æ–π —Å–≤–æ–¥–∫–∏ —Å –∏—Ç–æ–≥–∞–º–∏ –º–µ—Å—è—Ü–∞"""
    global user_rating_stats
    
    if application is None:
        logger.error("Application –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
        return
    
    try:
        now = datetime.now(MOSCOW_TZ)
        month_name = now.strftime("%B %Y")
        
        monthly_text = f"üèÜ **–ò—Ç–æ–≥–∏ –º–µ—Å—è—Ü–∞: {month_name}** üèÜ\n\n"
        
        # –û–±—â–∏–π —Ç–æ–ø-10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∑–∞ –º–µ—Å—è—Ü
        top_rated = await get_top_rated_users()
        
        if top_rated:
            monthly_text += "üåü **–¢–æ–ø-10 –ª–µ–≥–µ–Ω–¥ –º–µ—Å—è—Ü–∞:**\n"
            medals_rating = ["ü•á", "ü•à", "ü•â", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£", "8Ô∏è‚É£", "9Ô∏è‚É£", "üîü"]
            
            for i, user in enumerate(top_rated):
                level_emoji = LEVEL_EMOJIS.get(user["level"], "")
                monthly_text += f"{medals_rating[i]} {level_emoji} **{user['name']}**\n"
                monthly_text += f"   ‚îî‚îÄ üèÖ {user['points']} –æ—á–∫–æ–≤ | üìù{user['messages']} | üì∑{user['photos']} | ‚ù§Ô∏è{user['likes']} | üí¨{user['replies']}\n"
            monthly_text += "\n"
        else:
            monthly_text += "üåü **–¢–æ–ø-10 –ª–µ–≥–µ–Ω–¥ –º–µ—Å—è—Ü–∞:** –ü–æ–∫–∞ –Ω–∏–∫–æ–≥–æ –Ω–µ—Ç\n\n"
        
        # –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ –ø–æ –Ω–æ–º–∏–Ω–∞—Ü–∏—è–º
        monthly_text += "üéñÔ∏è **–ù–æ–º–∏–Ω–∞—Ü–∏–∏ –º–µ—Å—è—Ü–∞:**\n"
        
        # –°–∞–º–æ–µ –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ
        if top_rated:
            monthly_text += f"ü•á **{top_rated[0]['name']}** ‚Äî –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ª–∏–¥–µ—Ä –º–µ—Å—è—Ü–∞!\n"
        
        # –ú–∞–∫—Å–∏–º—É–º —Å–æ–æ–±—â–µ–Ω–∏–π
        if user_rating_stats:
            max_messages_user = max(user_rating_stats.items(), key=lambda x: x[1]["messages"])
            monthly_text += f"üí¨ **{max_messages_user[1]['name']}** ‚Äî –ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π ({max_messages_user[1]['messages']})\n"
        
        # –ú–∞–∫—Å–∏–º—É–º —Ñ–æ—Ç–æ
        if user_rating_stats:
            max_photos_user = max(user_rating_stats.items(), key=lambda x: x[1]["photos"])
            if max_photos_user[1]["photos"] > 0:
                monthly_text += f"üì∑ **{max_photos_user[1]['name']}** ‚Äî –§–æ—Ç–æ–≥–µ–Ω–∏–π –º–µ—Å—è—Ü–∞ ({max_photos_user[1]['photos']} —Ñ–æ—Ç–æ)\n"
        
        # –ú–∞–∫—Å–∏–º—É–º –ª–∞–π–∫–æ–≤
        if user_rating_stats:
            max_likes_user = max(user_rating_stats.items(), key=lambda x: x[1]["likes"])
            if max_likes_user[1]["likes"] > 0:
                monthly_text += f"‚ù§Ô∏è **{max_likes_user[1]['name']}** ‚Äî –°–∞–º—ã–π –ª—é–±–∏–º—ã–π –∞–≤—Ç–æ—Ä ({max_likes_user[1]['likes']} –ª–∞–π–∫–æ–≤)\n"
        
        # –ú–∞–∫—Å–∏–º—É–º –æ—Ç–≤–µ—Ç–æ–≤
        if user_rating_stats:
            max_replies_user = max(user_rating_stats.items(), key=lambda x: x[1]["replies"])
            if max_replies_user[1]["replies"] > 0:
                monthly_text += f"üí¨ **{max_replies_user[1]['name']}** ‚Äî –°–∞–º—ã–π –æ—Ç–∑—ã–≤—á–∏–≤—ã–π ({max_replies_user[1]['replies']} –æ—Ç–≤–µ—Ç–æ–≤)\n"
        
        monthly_text += "\n"
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–µ—Å—è—Ü–∞
        total_messages = sum(stats["messages"] for stats in user_rating_stats.values())
        total_photos = sum(stats["photos"] for stats in user_rating_stats.values())
        total_likes = sum(stats["likes"] for stats in user_rating_stats.values())
        total_replies = sum(stats["replies"] for stats in user_rating_stats.values())
        
        monthly_text += "üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–µ—Å—è—Ü–∞:**\n"
        monthly_text += f"üí¨ –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π: {total_messages}\n"
        monthly_text += f"üì∑ –í—Å–µ–≥–æ —Ñ–æ—Ç–æ: {total_photos}\n"
        monthly_text += f"‚ù§Ô∏è –í—Å–µ–≥–æ –ª–∞–π–∫–æ–≤: {total_likes}\n"
        monthly_text += f"üí¨ –í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤: {total_replies}\n"
        monthly_text += f"üë• –ê–∫—Ç–∏–≤–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: {len(user_rating_stats)}\n\n"
        
        # –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤—ã—Ö –ª–µ–≥–µ–Ω–¥
        legends = [uid for uid in user_rating_stats.keys() if get_user_level(uid) == "–õ–µ–≥–µ–Ω–¥–∞ —á–∞—Ç–∞"]
        if legends:
            monthly_text += "üéâ **–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤—ã—Ö –ª–µ–≥–µ–Ω–¥ —á–∞—Ç–∞!**\n"
            for uid in legends:
                monthly_text += f"   üèÜ {user_rating_stats[uid]['name']}\n"
        
        # –ù–æ–≤—ã–µ –ª–∏–¥–µ—Ä—ã
        leaders = [uid for uid in user_rating_stats.keys() if get_user_level(uid) == "–õ–∏–¥–µ—Ä"]
        if leaders:
            monthly_text += "üåü **–ù–æ–≤—ã–µ –ª–∏–¥–µ—Ä—ã:**\n"
            for uid in leaders:
                monthly_text += f"   üëë {user_rating_stats[uid]['name']}\n"
        
        monthly_text += "\nüèÉ‚Äç‚ôÇÔ∏è –î–æ –≤—Å—Ç—Ä–µ—á–∏ –≤ —Å–ª–µ–¥—É—é—â–µ–º –º–µ—Å—è—Ü–µ!\n"
        monthly_text += "üí™ –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –±–µ–≥–∞—Ç—å –∏ –Ω–∞–±–∏—Ä–∞—Ç—å –æ—á–∫–∏!"
        
        await application.bot.send_message(
            chat_id=CHAT_ID,
            text=monthly_text,
            parse_mode="Markdown",
        )
        
        logger.info("–ï–∂–µ–º–µ—Å—è—á–Ω–∞—è —Å–≤–æ–¥–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞")
        
        # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ—Å–ª–µ –º–µ—Å—è—á–Ω–æ–π —Å–≤–æ–¥–∫–∏
        user_rating_stats = {}
        logger.info("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –º–µ—Å—è—Ü–∞")
        
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –µ–∂–µ–º–µ—Å—è—á–Ω–æ–π —Å–≤–æ–¥–∫–∏: {e}")


async def daily_summary_scheduler_task():
    """–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π, –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–π –∏ –µ–∂–µ–º–µ—Å—è—á–Ω–æ–π —Å–≤–æ–¥–æ–∫"""
    global daily_summary_sent, current_week
    
    while bot_running:
        now = datetime.now(MOSCOW_TZ)
        current_hour = now.hour
        current_minute = now.minute
        today_date = now.strftime("%Y-%m-%d")
        
        # –°–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –ø–æ–ª–Ω–æ—á—å
        if now.hour == 0 and current_minute == 0:
            daily_summary_sent = False
        
        # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–≤–æ–¥–∫–∏ –≤ 23:59
        if current_hour == 23 and current_minute == 59:
            if not daily_summary_sent:
                logger.info("–í—Ä–µ–º—è 23:59 - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é —Å–≤–æ–¥–∫—É")
                try:
                    await send_daily_summary()
                except Exception as e:
                    logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–≤–æ–¥–∫–∏: {e}")
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–¥–µ–ª–∏ (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 23:00 - –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞)
        if now.weekday() == 6 and current_hour == 23 and current_minute == 0:
            week_num = now.isocalendar()[1]
            if week_num != current_week:
                logger.info(f"–í—Ä–µ–º—è –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 23:00 - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—É—é —Å–≤–æ–¥–∫—É")
                try:
                    await send_weekly_summary()
                    current_week = week_num
                except Exception as e:
                    logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–π —Å–≤–æ–¥–∫–∏: {e}")
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ü–∞ –º–µ—Å—è—Ü–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ –≤ 23:00)
        last_day_of_month = (now.replace(day=28) + timedelta(days=4)).day - (now.replace(day=28) + timedelta(days=4)).day % 28
        if now.day == last_day_of_month and current_hour == 23 and current_minute == 0:
            logger.info(f"–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–∂–µ–º–µ—Å—è—á–Ω—É—é —Å–≤–æ–¥–∫—É")
            try:
                await send_monthly_summary()
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –µ–∂–µ–º–µ—Å—è—á–Ω–æ–π —Å–≤–æ–¥–∫–∏: {e}")
        
        await asyncio.sleep(60)


# ============== –ê–ù–û–ù–ò–ú–ù–ê–Ø –û–¢–ü–†–ê–í–ö–ê ==============
async def anon(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.message.from_user.id
    user_anon_state[user_id] = "waiting_for_text"

    try:
        await update.message.delete()
    except Exception:
        pass


async def anonphoto(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.message.from_user.id
    user_anon_state[user_id] = "waiting_for_photo"

    try:
        await update.message.delete()
    except Exception:
        pass


async def handle_anon_text(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.message.from_user.id

    if user_id not in user_anon_state:
        return

    if user_anon_state[user_id] == "waiting_for_text":
        text = update.message.text
        target_mention = ""
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ @–Ω–∏–∫–Ω–µ–π–º –≤ –Ω–∞—á–∞–ª–µ
        import re
        match = re.match(r'^@(\w+)\s+(.+)', text)
        
        if match:
            target_username = match.group(1)
            message_text = match.group(2)
            target_mention = f"@{target_username}"
        else:
            message_text = text
        
        try:
            await update.message.delete()
        except Exception:
            pass

        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        if target_mention:
            anon_text = f"üì¨ **–ê–Ω–æ–Ω–∏–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è {target_mention}:**\n\n{message_text}"
        else:
            anon_text = f"üì¨ **–ê–Ω–æ–Ω–∏–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**\n\n{message_text}"
        
        await context.bot.send_message(
            chat_id=CHAT_ID,
            text=anon_text,
            parse_mode="Markdown",
        )

        del user_anon_state[user_id]


async def handle_anon_photo(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.message.from_user.id

    if user_id not in user_anon_state:
        return

    if user_anon_state[user_id] == "waiting_for_photo":
        photo = update.message.photo[-1]

        try:
            await update.message.delete()
        except Exception:
            pass

        await context.bot.send_photo(
            chat_id=CHAT_ID,
            photo=photo.file_id,
            caption="üì¨ **–ê–Ω–æ–Ω–∏–º–Ω–æ–µ —Ñ–æ—Ç–æ**",
            parse_mode="Markdown",
        )

        del user_anon_state[user_id]


# ============== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–û–ë–©–ï–ù–ò–ô –î–õ–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ò ==============
async def handle_all_messages(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
    global night_messages_count, night_warning_sent, user_last_active, daily_stats, user_rating_stats, user_current_level
    
    # –í—Å–µ–≥–¥–∞ –ª–æ–≥–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    logger.info(f"–ü–æ–ª—É—á–µ–Ω–æ update: {update}")
    
    if not update.message:
        logger.debug("–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ update")
        return
    
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–∞–Ω–¥—ã
    if update.message.text and update.message.text.startswith('/'):
        logger.debug("–≠—Ç–æ –∫–æ–º–∞–Ω–¥–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
        return
    
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –±–æ—Ç–æ–≤
    if update.message.from_user and update.message.from_user.is_bot:
        logger.debug("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –±–æ—Ç–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
        return
    
    try:
        user = update.message.from_user
        if not user:
            logger.debug("–ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ")
            return
            
        user_id = user.id
        user_name = f"@{user.username}" if user.username else user.full_name
        logger.info(f"–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç {user_name} (ID: {user_id})")
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É daily_stats
        photo_info = None
        is_photo = False
        if update.message.photo:
            is_photo = True
            photo = update.message.photo[-1]
            photo_info = {
                "file_id": photo.file_id,
                "user_id": user_id,
                "message_id": update.message.message_id,
            }
            logger.info("–≠—Ç–æ —Ñ–æ—Ç–æ")
        
        update_daily_stats(user_id, user_name, "photo" if photo_info else "text", photo_info)
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥ - —Å–æ–æ–±—â–µ–Ω–∏—è
        # –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        old_messages = user_rating_stats.get(user_id, {}).get("messages", 0)
        old_rating = calculate_user_rating(user_id)
        
        success, points, msg = update_rating_stats(user_id, user_name, "messages", 1)
        if success:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞–±—Ä–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ –±–∞–ª–ª–∞
            new_rating = calculate_user_rating(user_id)
            if new_rating > old_rating:
                await send_point_notification(user_name, 1, "—Å–æ–æ–±—â–µ–Ω–∏–µ", new_rating)
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
            new_level = get_user_level(user_id)
            old_level = user_current_level.get(user_id, "–ù–æ–≤–∏—á–æ–∫")
            if new_level != old_level and new_level != "–ù–æ–≤–∏—á–æ–∫":
                user_current_level[user_id] = new_level
                await send_level_up_notification(user_name, new_level)
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥ - —Ñ–æ—Ç–æ
        if is_photo:
            old_photos = user_rating_stats.get(user_id, {}).get("photos", 0)
            old_rating = calculate_user_rating(user_id)
            
            success, points, msg = update_rating_stats(user_id, user_name, "photos", 1)
            if success:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞–±—Ä–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ –±–∞–ª–ª–∞
                new_rating = calculate_user_rating(user_id)
                if new_rating > old_rating:
                    await send_point_notification(user_name, 1, "—Ñ–æ—Ç–æ", new_rating)
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
                new_level = get_user_level(user_id)
                old_level = user_current_level.get(user_id, "–ù–æ–≤–∏—á–æ–∫")
                if new_level != old_level and new_level != "–ù–æ–≤–∏—á–æ–∫":
                    user_current_level[user_id] = new_level
                    await send_level_up_notification(user_name, new_level)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–º –Ω–∞ –¥—Ä—É–≥–æ–µ —Å "+"
        if update.message.reply_to_message and update.message.reply_to_message.from_user:
            # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ–± –∞–≤—Ç–æ—Ä–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            original_author_id = update.message.reply_to_message.from_user.id
            original_author_name = f"@{update.message.reply_to_message.from_user.username}" if update.message.reply_to_message.from_user.username else update.message.reply_to_message.from_user.full_name
            
            # –ë–∞–ª–ª –¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞ –æ—Ç–≤–µ—Ç "+" (–ø–ª—é—Å)
            message_text = update.message.text or ""
            if message_text.strip() == "+" and original_author_id != user_id:
                # –î–∞—ë–º –±–∞–ª–ª –∞–≤—Ç–æ—Ä—É –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞ "+" –≤ –æ—Ç–≤–µ—Ç
                success, points_earned, msg = update_rating_stats(original_author_id, original_author_name, "replies", 1)
                if success and points_earned > 0:
                    total = calculate_user_rating(original_author_id)
                    await send_point_notification(original_author_name, points_earned, "–æ—Ç–≤–µ—Ç", total)
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
                    new_level = get_user_level(original_author_id)
                    old_level = user_current_level.get(original_author_id, "–ù–æ–≤–∏—á–æ–∫")
                    if new_level != old_level and new_level != "–ù–æ–≤–∏—á–æ–∫":
                        user_current_level[original_author_id] = new_level
                        await send_level_up_notification(original_author_name, new_level)
                    logger.info(f"–ê–≤—Ç–æ—Ä {original_author_name} –ø–æ–ª—É—á–∏–ª {points_earned} –±–∞–ª–ª(–æ–≤) –∑–∞ + –æ—Ç {user_name}")
        
        # –õ–æ–≥–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        logger.info(f"–¢–µ–∫—É—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {daily_stats['total_messages']} —Å–æ–æ–±—â–µ–Ω–∏–π")
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
        now = datetime.now(MOSCOW_TZ)
        if now.hour >= 22 and now.hour < 24:
            night_messages_count += 1
            logger.info(f"–ù–æ—á–Ω–æ–π —Ä–µ–∂–∏–º: {night_messages_count} —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ—Å–ª–µ 22:00")
            if night_messages_count >= 10 and not night_warning_sent:
                warning = random.choice(NIGHT_WARNINGS)
                try:
                    await context.bot.send_message(chat_id=CHAT_ID, text=warning)
                    night_warning_sent = True
                    logger.info("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–æ—á–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ")
                except Exception as e:
                    logger.error(f"–û—à–∏–±–∫–∞ –Ω–æ—á–Ω–æ–≥–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: {e}")
        
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ handle_all_messages: {e}", exc_info=True)


async def handle_callback_query(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ callback-–∑–∞–ø—Ä–æ—Å–æ–≤ (—Ä–µ–∞–∫—Ü–∏–π)"""
    # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–µ–∞–∫—Ü–∏–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    # Telegram Bot API –Ω–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∞–∫—Ü–∏—è—Ö –≤ callback
    pass


# ============== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ==============
START_MESSAGE = """üèÉ **–ë–æ—Ç –¥–ª—è –±–µ–≥–æ–≤–æ–≥–æ —á–∞—Ç–∞**

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
‚Ä¢ 06:00 ‚Äî –£—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + –ø–æ–≥–æ–¥–∞ + —Ç–µ–º–∞ –¥–Ω—è
‚Ä¢ 11:00 ‚Äî –ú–æ—Ç–∏–≤–∞—Ü–∏—è
‚Ä¢ 16:00 ‚Äî –ú–æ—Ç–∏–≤–∞—Ü–∏—è
‚Ä¢ 21:00 ‚Äî –ú–æ—Ç–∏–≤–∞—Ü–∏—è
‚Ä¢ 22:00+ ‚Äî –ù–æ—á–Ω–æ–π —Ä–µ–∂–∏–º (–ø–æ—Å–ª–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Å–ø–∞—Ç—å)
‚Ä¢ 23:59 ‚Äî –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞
‚Ä¢ –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 23:00 ‚Äî –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º
‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ 23:00 ‚Äî –ò—Ç–æ–≥–∏ –º–µ—Å—è—Ü–∞
‚Ä¢ –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –ø–æ—Å–ª–µ 2+ –Ω–µ–¥–µ–ª—å ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç –±–æ—Ç–∞
‚Ä¢ –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –±–∞–ª–ª–æ–≤ ‚Äî –ø—É–±–ª–∏—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ —á–∞—Ç–µ

**–°–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞:**
üìù 300 —Å–æ–æ–±—â–µ–Ω–∏–π = 1 –±–∞–ª–ª
üì∑ 10 —Ñ–æ—Ç–æ = 1 –±–∞–ª–ª
‚ù§Ô∏è 50 –ª–∞–π–∫–æ–≤ = 1 –±–∞–ª–ª
üí¨ –û—Ç–≤–µ—Ç –Ω–∞ —Ç–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ = 1 –±–∞–ª–ª

**–ö–æ–º–∞–Ω–¥—ã:**
‚Ä¢ /start ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
‚Ä¢ /morning ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–µ–π—á–∞—Å
‚Ä¢ /stopmorning ‚Äî —É–¥–∞–ª–∏—Ç—å —É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
‚Ä¢ /anon @–Ω–∏–∫–Ω–µ–π–º —Ç–µ–∫—Å—Ç ‚Äî –∞–Ω–æ–Ω–∏–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
‚Ä¢ /anonphoto ‚Äî –∞–Ω–æ–Ω–∏–º–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ
‚Ä¢ /remen ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Ä—Ü–∏—é —Å–º–µ—à–Ω—ã—Ö —Ä—É–≥–∞—Ç–µ–ª—å—Å—Ç–≤
‚Ä¢ /antiremen ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Ä—Ü–∏—é —Å–º–µ—à–Ω—ã—Ö –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–æ–≤
‚Ä¢ /summary ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ–¥–∫—É –∑–∞ —Å–µ–≥–æ–¥–Ω—è
‚Ä¢ /rating ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ø-10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
‚Ä¢ /levels ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º
‚Ä¢ /weekly ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—É—é —Å–≤–æ–¥–∫—É
‚Ä¢ /monthly ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∏—Ç–æ–≥–∏ –º–µ—Å—è—Ü–∞"""


async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await context.bot.send_message(
        chat_id=update.effective_chat.id,
        text=START_MESSAGE,
    )

    try:
        await update.message.delete()
    except Exception:
        pass


async def morning(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await send_morning_greeting()

    try:
        await update.message.delete()
    except Exception:
        pass


async def stopmorning(update: Update, context: ContextTypes.DEFAULT_TYPE):
    global morning_message_id

    if morning_message_id is not None:
        try:
            await application.bot.delete_message(
                chat_id=CHAT_ID,
                message_id=morning_message_id,
            )
            await context.bot.send_message(
                chat_id=update.effective_chat.id,
                text="‚òÄÔ∏è –£—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!",
            )
            morning_message_id = None
        except Exception:
            await context.bot.send_message(
                chat_id=update.effective_chat.id,
                text="‚ùå –£—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∏–ª–∏ —É–∂–µ —É–¥–∞–ª–µ–Ω–æ!",
            )
    else:
        await context.bot.send_message(
            chat_id=update.effective_chat.id,
            text="‚ùå –£—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!",
        )

    try:
        await update.message.delete()
    except Exception:
        pass


async def remen(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–º–µ—à–Ω—ã—Ö —Ä—É–≥–∞—Ç–µ–ª—å—Å—Ç–≤"""
    insult = get_random_insult()
    
    await context.bot.send_message(
        chat_id=update.effective_chat.id,
        text=f"üòÑ **{insult}**",
        parse_mode="Markdown",
    )

    try:
        await update.message.delete()
    except Exception:
        pass


async def antiremen(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–º–µ—à–Ω—ã—Ö –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–æ–≤"""
    compliment = get_random_compliment()
    
    await context.bot.send_message(
        chat_id=update.effective_chat.id,
        text=f"üíñ **{compliment}**",
        parse_mode="Markdown",
    )

    try:
        await update.message.delete()
    except Exception:
        pass


async def summary(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–≤–æ–¥–∫–∏ –ø–æ –∫–æ–º–∞–Ω–¥–µ"""
    # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
    global daily_summary_sent
    was_sent = daily_summary_sent
    daily_summary_sent = False
    
    try:
        await send_daily_summary()
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Å–≤–æ–¥–∫–∏: {e}")
        await context.bot.send_message(
            chat_id=update.effective_chat.id,
            text="‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–≤–æ–¥–∫–∏",
        )
    
    # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    daily_summary_sent = was_sent
    
    try:
        await update.message.delete()
    except Exception:
        pass


async def rating(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ö–æ–º–∞–Ω–¥–∞ /rating ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø-10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ –æ—á–∫–∞–º"""
    try:
        top_rated = await get_top_rated_users()
        
        rating_text = "‚≠ê **–†–µ–π—Ç–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –±–µ–≥–æ–≤–æ–≥–æ —á–∞—Ç–∞**\n\n"
        
        if top_rated:
            medals_rating = ["ü•á", "ü•à", "ü•â", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£", "8Ô∏è‚É£", "9Ô∏è‚É£", "üîü"]
            for i, user in enumerate(top_rated):
                level_emoji = LEVEL_EMOJIS.get(user["level"], "")
                rating_text += f"{medals_rating[i]} {level_emoji} **{user['name']}** ‚Äî **{user['points']}** –æ—á–∫–æ–≤\n"
                
                # –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é
                details_parts = []
                
                # –°–æ–æ–±—â–µ–Ω–∏—è
                msg_progress = user['messages'] % POINTS_PER_MESSAGES
                details_parts.append(f"üìù {user['messages']} —Å–æ–æ–±—â–µ–Ω–∏–π (+{POINTS_PER_MESSAGES - msg_progress} –¥–æ —Å–ª. –±–∞–ª–ª–∞)")
                
                # –§–æ—Ç–æ
                photo_progress = user['photos'] % POINTS_PER_PHOTOS
                details_parts.append(f"üì∑ {user['photos']} —Ñ–æ—Ç–æ (+{POINTS_PER_PHOTOS - photo_progress} –¥–æ —Å–ª. –±–∞–ª–ª–∞)")
                
                # –õ–∞–π–∫–∏
                like_progress = user['likes'] % POINTS_PER_LIKES
                details_parts.append(f"‚ù§Ô∏è {user['likes']} –ª–∞–π–∫–æ–≤ (+{POINTS_PER_LIKES - like_progress} –¥–æ —Å–ª. –±–∞–ª–ª–∞)")
                
                # –û—Ç–≤–µ—Ç—ã
                details_parts.append(f"üí¨ {user['replies']} –æ—Ç–≤–µ—Ç–æ–≤\n")
                
                # –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏ —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏
                for detail in details_parts:
                    rating_text += f"   {detail}\n"
                
                rating_text += "\n"  # –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
        else:
            rating_text += "–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –Ω–∞–±—Ä–∞–ª –æ—á–∫–æ–≤. –ü–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –¥–µ–ª–∏—Ç–µ—Å—å —Ñ–æ—Ç–æ –∏ –æ—Ç–≤–µ—á–∞–π—Ç–µ –¥—Ä—É–≥ –¥—Ä—É–≥—É! üèÉ‚Äç‚ôÇÔ∏è\n\n"
            rating_text += "üìä **–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –æ—á–∫–∏:**\n"
            rating_text += f"‚Ä¢ **{POINTS_PER_MESSAGES} —Å–æ–æ–±—â–µ–Ω–∏–π** = 1 –±–∞–ª–ª\n"
            rating_text += f"‚Ä¢ **{POINTS_PER_PHOTOS} —Ñ–æ—Ç–æ** = 1 –±–∞–ª–ª\n"
            rating_text += f"‚Ä¢ **{POINTS_PER_LIKES} –ª–∞–π–∫–æ–≤** –Ω–∞ –≤–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è = 1 –±–∞–ª–ª\n"
            rating_text += f"‚Ä¢ **–û—Ç–≤–µ—Ç –Ω–∞ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** = 1 –±–∞–ª–ª\n"
        
        await context.bot.send_message(
            chat_id=update.effective_chat.id,
            text=rating_text,
            parse_mode="Markdown",
        )
        
        try:
            await update.message.delete()
        except Exception:
            pass
            
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∫–æ–º–∞–Ω–¥—ã rating: {e}")
        await context.bot.send_message(
            chat_id=update.effective_chat.id,
            text="‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞",
        )


async def levels(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ö–æ–º–∞–Ω–¥–∞ /levels ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º"""
    try:
        # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º
        levels_summary = {
            "–õ–µ–≥–µ–Ω–¥–∞ —á–∞—Ç–∞": [],
            "–õ–∏–¥–µ—Ä": [],
            "–ê–∫—Ç–∏–≤–Ω—ã–π": [],
            "–ù–æ–≤–∏—á–æ–∫": []
        }
        
        for user_id, stats in user_rating_stats.items():
            level = get_user_level(user_id)
            total_points = calculate_user_rating(user_id)
            levels_summary[level].append({
                "name": stats["name"],
                "points": total_points,
                "level": level
            })
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è –ø–æ –æ—á–∫–∞–º
        for level in levels_summary:
            levels_summary[level].sort(key=lambda x: x["points"], reverse=True)
        
        levels_text = "üåü **–£—Ä–æ–≤–Ω–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –±–µ–≥–æ–≤–æ–≥–æ —á–∞—Ç–∞**\n\n"
        
        # –í—ã–≤–æ–¥–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º (–æ—Ç –≤—ã—Å–æ–∫–æ–≥–æ –∫ –Ω–∏–∑–∫–æ–º—É)
        level_order = ["–õ–µ–≥–µ–Ω–¥–∞ —á–∞—Ç–∞", "–õ–∏–¥–µ—Ä", "–ê–∫—Ç–∏–≤–Ω—ã–π", "–ù–æ–≤–∏—á–æ–∫"]
        
        for level in level_order:
            users = levels_summary[level]
            if users:
                level_emoji = LEVEL_EMOJIS.get(level, "")
                levels_text += f"{level_emoji} **{level}** ({len(users)} —á–µ–ª.):\n"
                
                # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —É—Ä–æ–≤–Ω—è
                for user in users:
                    levels_text += f"   üèÖ {user['name']} ‚Äî {user['points']} –æ—á–∫–æ–≤\n"
                
                levels_text += "\n"
        
        if not any(levels_summary.values()):
            levels_text += "–ü–æ–∫–∞ –Ω–∏–∫–æ–≥–æ –Ω–µ—Ç –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ. –ù–∞—á–Ω–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω–∏—á–∞—Ç—å! üèÉ‚Äç‚ôÇÔ∏è\n\n"
        
        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Ä–æ–≤–Ω—è—Ö
        levels_text += "üìä **–£—Ä–æ–≤–Ω–∏ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**\n"
        levels_text += f"üå± **–ù–æ–≤–∏—á–æ–∫** ‚Äî 0-{USER_LEVELS['–ê–∫—Ç–∏–≤–Ω—ã–π']-1} –æ—á–∫–æ–≤\n"
        levels_text += f"‚≠ê **–ê–∫—Ç–∏–≤–Ω—ã–π** ‚Äî {USER_LEVELS['–ê–∫—Ç–∏–≤–Ω—ã–π']}-{USER_LEVELS['–õ–∏–¥–µ—Ä']-1} –æ—á–∫–æ–≤\n"
        levels_text += f"üëë **–õ–∏–¥–µ—Ä** ‚Äî {USER_LEVELS['–õ–∏–¥–µ—Ä']}-{USER_LEVELS['–õ–µ–≥–µ–Ω–¥–∞ —á–∞—Ç–∞']-1} –æ—á–∫–æ–≤\n"
        levels_text += f"üèÜ **–õ–µ–≥–µ–Ω–¥–∞ —á–∞—Ç–∞** ‚Äî {USER_LEVELS['–õ–µ–≥–µ–Ω–¥–∞ —á–∞—Ç–∞']}+ –æ—á–∫–æ–≤\n"
        
        await context.bot.send_message(
            chat_id=update.effective_chat.id,
            text=levels_text,
            parse_mode="Markdown",
        )
        
        try:
            await update.message.delete()
        except Exception:
            pass
            
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∫–æ–º–∞–Ω–¥—ã levels: {e}")
        await context.bot.send_message(
            chat_id=update.effective_chat.id,
            text="‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ —É—Ä–æ–≤–Ω–µ–π",
        )


async def weekly(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ö–æ–º–∞–Ω–¥–∞ /weekly ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—É—é —Å–≤–æ–¥–∫—É"""
    try:
        await send_weekly_summary()
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∫–æ–º–∞–Ω–¥—ã weekly: {e}")
        await context.bot.send_message(
            chat_id=update.effective_chat.id,
            text="‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–π —Å–≤–æ–¥–∫–∏",
        )
    
    try:
        await update.message.delete()
    except Exception:
        pass


async def monthly(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ö–æ–º–∞–Ω–¥–∞ /monthly ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –µ–∂–µ–º–µ—Å—è—á–Ω—É—é —Å–≤–æ–¥–∫—É"""
    try:
        await send_monthly_summary()
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∫–æ–º–∞–Ω–¥—ã monthly: {e}")
        await context.bot.send_message(
            chat_id=update.effective_chat.id,
            text="‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –µ–∂–µ–º–µ—Å—è—á–Ω–æ–π —Å–≤–æ–¥–∫–∏",
        )
    
    try:
        await update.message.delete()
    except Exception:
        pass


async def welcome_new_member(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not update.message or not update.message.new_chat_members:
        return

    try:
        bot_info = await context.bot.get_me()
        bot_id = bot_info.id
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è ID –±–æ—Ç–∞: {e}")
        bot_id = None

    for member in update.message.new_chat_members:
        if member.is_bot or (bot_id and member.id == bot_id):
            continue

        welcome = get_random_welcome()
        try:
            if member.username:
                mention = f"@{member.username}"
            else:
                mention = member.full_name

            await context.bot.send_message(
                chat_id=update.effective_chat.id,
                text=f"{mention} {welcome}",
            )
            logger.info(f"–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {member.id}")
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è: {e}")


# ============== KEEP-ALIVE ==============
def keep_alive_pinger():
    """–ü–∏–Ω–≥–æ–≤–∞–Ω–∏–µ –¥–ª—è keep-alive"""
    while bot_running:
        try:
            time.sleep(300)
            if RENDER_URL and RENDER_URL != "YOUR_RENDER_URL_HERE":
                response = httpx.get(f"{RENDER_URL}/health", timeout=30)
                if response.status_code == 200:
                    logger.info(f"Ping successful: {RENDER_URL}/health")
                else:
                    logger.warning(f"Ping returned status {response.status_code}")
        except Exception:
            pass


if __name__ == "__main__":
    loop = asyncio.new_event_loop()
    asyncio.set_event_loop(loop)
    
    def stop_all():
        global bot_running
        bot_running = False
        if application:
            application.stop()
        sys.exit(0)
    
    signal.signal(signal.SIGTERM, stop_all)
    signal.signal(signal.SIGINT, stop_all)
    
    flask_thread = threading.Thread(target=run_flask, daemon=True)
    flask_thread.start()
    logger.info("Flask –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 10000")
    
    application = (
        ApplicationBuilder()
        .token(BOT_TOKEN)
        .concurrent_updates(True)
        .build()
    )
    
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("morning", morning))
    application.add_handler(CommandHandler("stopmorning", stopmorning))
    application.add_handler(CommandHandler("remen", remen))
    application.add_handler(CommandHandler("antiremen", antiremen))
    application.add_handler(CommandHandler("summary", summary))
    application.add_handler(CommandHandler("rating", rating))
    application.add_handler(CommandHandler("levels", levels))
    application.add_handler(CommandHandler("weekly", weekly))
    application.add_handler(CommandHandler("monthly", monthly))
    application.add_handler(CommandHandler("anon", anon))
    application.add_handler(CommandHandler("anonphoto", anonphoto))
    application.add_handler(
        MessageHandler(filters.TEXT & ~filters.COMMAND, handle_anon_text)
    )
    application.add_handler(
        MessageHandler(filters.PHOTO & ~filters.COMMAND, handle_anon_photo)
    )
    application.add_handler(
        MessageHandler(filters.ALL & ~filters.COMMAND & ~filters.StatusUpdate.NEW_CHAT_MEMBERS, handle_all_messages)
    )
    application.add_handler(CallbackQueryHandler(handle_callback_query))
    application.add_handler(
        MessageHandler(filters.StatusUpdate.NEW_CHAT_MEMBERS, welcome_new_member)
    )
    
    loop.create_task(morning_scheduler_task())
    loop.create_task(motivation_scheduler_task())
    loop.create_task(daily_summary_scheduler_task())
    
    pinger_thread = threading.Thread(target=keep_alive_pinger, daemon=True)
    pinger_thread.start()
    
    logger.info("–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏ –∑–∞–ø—É—â–µ–Ω—ã")
    
    application.run_polling(drop_pending_updates=True)






